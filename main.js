!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("Vue")):"function"==typeof define&&define.amd?define(["Vue"],n):"object"==typeof exports?exports.MyVueComponents=n(require("Vue")):e.MyVueComponents=n(e.Vue)}(self,(function(e){return function(){var n={601:function(e,n,t){"use strict";t.r(n);var r=t(982),i=t.n(r),o=t(314),a=t.n(o)()(i());a.push([e.id,"\n.phone-button[data-v-7a0d2670] {\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  border-radius: 50%;\n  position: fixed;\n  bottom: 20px;\n  right: 20px;\n  cursor: pointer;\n  z-index: 200;\n  background: var(--widgetBtnIdleBackground);\n  width: var(--widgetBtnSize);\n  height: var(--widgetBtnSize);\n}\n.phone-button__widget-icon[data-v-7a0d2670] {\n  width: var(--widgetBtnImageSize);\n  height: var(--widgetBtnImageSize);\n}\n.phone-button.phone-button--call[data-v-7a0d2670] {\n  background: var(--widgetBtnCallBackground);\n}\n.phone-button.phone-button--calling[data-v-7a0d2670] {\n  background: var(--widgetBtnCallingackground);\n}\n",""]),n.default=a},169:function(e,n,t){"use strict";t.r(n);var r=t(982),i=t.n(r),o=t(314),a=t.n(o)()(i());a.push([e.id,"\n.phone-widget {\n  font-family: var(--fontFamily);\n  overflow: hidden;\n}\n* {\n  box-sizing: border-box;\n  margin: 0;\n  padding: 0;\n}\n",""]),n.default=a},379:function(e,n,t){"use strict";t.r(n);var r=t(982),i=t.n(r),o=t(314),a=t.n(o)()(i());a.push([e.id,"\n.phone-widget__dropdown-container[data-v-0dae9322] {\n  width: 30vw;\n  max-width: 280px;\n  height: 400px;\n  position: absolute;\n  bottom: 20px;\n  right: 20px;\n  border-radius: 10px;\n}\n.phone-widget__dropdown-minimize[data-v-0dae9322] {\n  position: absolute;\n  top: 0;\n  right: 15px;\n}\n.phone-widget__dropdown-minimize-icon[data-v-0dae9322] {\n  width: 20px;\n  cursor: pointer;\n}\n.phone-widget__dropdown-header[data-v-0dae9322] {\n  height: 60px;\n  display: flex;\n  border-radius: 9px 9px 0 0;\n  align-items: center;\n  padding: 0 10px 0 10px;\n}\n.phone-widget__dropdown-header .phone-widget__dropdown-header-image[data-v-0dae9322] {\n  width: 50px;\n  height: 50px;\n  border-radius: 400px;\n}\n.phone-widget__dropdown-body[data-v-0dae9322] {\n  width: 100%;\n  height: 100%;\n  max-height: 400px;\n  border-radius: 10px 10px 10px 10px;\n  background: var(--widgetBackground);\n}\n.phone-widget__dropdown-advices-container[data-v-0dae9322] {\n  font-size: 17px;\n  height: 100%;\n  text-align: center;\n}\n.phone-widget__dropdown-advice[data-v-0dae9322] {\n  background: transparent;\n  width: 100%;\n  height: 100%;\n  border-radius: 10px 10px 10px 10px;\n  font-size: 17px;\n}\n.phone-widget__dropdown-advice-body[data-v-0dae9322] {\n  background: transparent;\n  height: 100%;\n  border-radius: 10px 10px 10px 10px;\n  font-size: 17px;\n  overflow: hidden;\n}\n.phone-widget__dropdown-headphones-advice[data-v-0dae9322] {\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-start;\n  align-items: center;\n  font-size: 16px;\n  padding: 25px 10px 0 10px;\n  gap: 15px;\n  height: 200px;\n}\n.phone-widget__dropdown-headphones-advice-image[data-v-0dae9322] {\n  width: 40px;\n}\n.phone-widget__dropdown-top-advices-container[data-v-0dae9322] {\n  height: 200px;\n  display: flex;\n  align-items: flex-end;\n  padding: 0 10px 25px 10px;\n}\n\n/* IN IDLE*/\n.phone-widget__dropdown-advice-idle[data-v-0dae9322] {\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  height: 100%;\n  gap: 10px;\n  padding: 0 10px;\n}\n.phone-widget__dropdown-advice-idle-circle[data-v-0dae9322] {\n  width: var(--btnSize);\n  height: var(--btnSize);\n  border-radius: 50%;\n  background: var(--btnIdleBackground);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  cursor: pointer;\n}\n.phone-widget__dropdown-advice-idle-circle-icon[data-v-0dae9322] {\n  width: calc(var(--btnSize) - 25px);\n  height: calc(var(--btnSize) - 25px);\n  color: white;\n}\n\n/* IN CALL */\n.phone-widget__dropdown-advice-in-call-circle[data-v-0dae9322] {\n  width: var(--btnSize);\n  height: var(--btnSize);\n  border-radius: 50%;\n  background: var(--btnCallBackground);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  cursor: pointer;\n}\n.phone-widget__dropdown-advice-in-call-circle-icon[data-v-0dae9322] {\n  width: calc(var(--btnSize) - 25px);\n  height: calc(var(--btnSize) - 25px);\n  transform: rotate(138deg);\n}\n.phone-widget__dropdown-advice-in-call[data-v-0dae9322] {\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  height: 100%;\n  gap: 10px;\n}\n\n/* IN CALLING */\n.phone-widget__dropdown-advice-calling[data-v-0dae9322] {\n  display: flex;\n  font-size: 22px;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  width: 100%;\n  gap: 25px;\n  padding: 0 10px 0 10px;\n}\n.phone-widget__dropdown-advice-calling-circle-icon[data-v-0dae9322] {\n  width: calc(var(--btnSize) - 25px);\n  height: calc(var(--btnSize) - 25px);\n  animation: phone-shake-0dae9322 2000ms ease 0ms infinite normal forwards;\n}\n/*Loaders*/\n.phone-widget__dropdown-advice-calling-circle[data-v-0dae9322] {\n  width: var(--btnSize);\n  height: var(--btnSize);\n  border-radius: 50%;\n  background: var(--btnCallingBackground);\n  box-shadow: 0 0 0 0 var(--btnCallingBackground);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  animation: pulse-c6zlskmd-0dae9322 1s infinite;\n}\n@keyframes pulse-c6zlskmd-0dae9322 {\n100% {\n    box-shadow: 0 0 0 33.6px #0000;\n}\n}\n@keyframes phone-shake-0dae9322 {\n0%,\n  100% {\n    transform: rotate(0deg);\n    transform-origin: 50% 50%;\n}\n10% {\n    transform: rotate(8deg);\n}\n20%,\n  40%,\n  60% {\n    transform: rotate(-10deg);\n}\n30%,\n  50%,\n  70% {\n    transform: rotate(10deg);\n}\n80% {\n    transform: rotate(-8deg);\n}\n90% {\n    transform: rotate(8deg);\n}\n}\n",""]),n.default=a},314:function(e){"use strict";e.exports=function(e){var n=[];return n.toString=function(){return this.map((function(n){var t="",r=void 0!==n[5];return n[4]&&(t+="@supports (".concat(n[4],") {")),n[2]&&(t+="@media ".concat(n[2]," {")),r&&(t+="@layer".concat(n[5].length>0?" ".concat(n[5]):""," {")),t+=e(n),r&&(t+="}"),n[2]&&(t+="}"),n[4]&&(t+="}"),t})).join("")},n.i=function(e,t,r,i,o){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(r)for(var s=0;s<this.length;s++){var c=this[s][0];null!=c&&(a[c]=!0)}for(var d=0;d<e.length;d++){var l=[].concat(e[d]);r&&a[l[0]]||(void 0!==o&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=o),t&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=t):l[2]=t),i&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=i):l[4]="".concat(i)),n.push(l))}},n}},982:function(e){"use strict";e.exports=function(e){return e[1]}},262:function(e,n){"use strict";n.A=(e,n)=>{const t=e.__vccOpts||e;for(const[e,r]of n)t[e]=r;return t}},540:function(e,n,t){var r=t(601);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals),(0,t(534).A)("44d7e87b",r,!1,{})},316:function(e,n,t){var r=t(169);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals),(0,t(534).A)("5fff68bd",r,!1,{})},490:function(e,n,t){var r=t(379);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals),(0,t(534).A)("99e58ada",r,!1,{})},534:function(e,n,t){"use strict";function r(e,n){for(var t=[],r={},i=0;i<n.length;i++){var o=n[i],a=o[0],s={id:e+":"+i,css:o[1],media:o[2],sourceMap:o[3]};r[a]?r[a].parts.push(s):t.push(r[a]={id:a,parts:[s]})}return t}t.d(n,{A:function(){return v}});var i="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!i)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var o={},a=i&&(document.head||document.getElementsByTagName("head")[0]),s=null,c=0,d=!1,l=function(){},u=null,p="data-vue-ssr-id",f="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function v(e,n,t,i){d=t,u=i||{};var a=r(e,n);return m(a),function(n){for(var t=[],i=0;i<a.length;i++){var s=a[i];(c=o[s.id]).refs--,t.push(c)}for(n?m(a=r(e,n)):a=[],i=0;i<t.length;i++){var c;if(0===(c=t[i]).refs){for(var d=0;d<c.parts.length;d++)c.parts[d]();delete o[c.id]}}}}function m(e){for(var n=0;n<e.length;n++){var t=e[n],r=o[t.id];if(r){r.refs++;for(var i=0;i<r.parts.length;i++)r.parts[i](t.parts[i]);for(;i<t.parts.length;i++)r.parts.push(h(t.parts[i]));r.parts.length>t.parts.length&&(r.parts.length=t.parts.length)}else{var a=[];for(i=0;i<t.parts.length;i++)a.push(h(t.parts[i]));o[t.id]={id:t.id,refs:1,parts:a}}}}function g(){var e=document.createElement("style");return e.type="text/css",a.appendChild(e),e}function h(e){var n,t,r=document.querySelector("style["+p+'~="'+e.id+'"]');if(r){if(d)return l;r.parentNode.removeChild(r)}if(f){var i=c++;r=s||(s=g()),n=y.bind(null,r,i,!1),t=y.bind(null,r,i,!0)}else r=g(),n=S.bind(null,r),t=function(){r.parentNode.removeChild(r)};return n(e),function(r){if(r){if(r.css===e.css&&r.media===e.media&&r.sourceMap===e.sourceMap)return;n(e=r)}else t()}}var w,b=(w=[],function(e,n){return w[e]=n,w.filter(Boolean).join("\n")});function y(e,n,t,r){var i=t?"":r.css;if(e.styleSheet)e.styleSheet.cssText=b(n,i);else{var o=document.createTextNode(i),a=e.childNodes;a[n]&&e.removeChild(a[n]),a.length?e.insertBefore(o,a[n]):e.appendChild(o)}}function S(e,n){var t=n.css,r=n.media,i=n.sourceMap;if(r&&e.setAttribute("media",r),u.ssrId&&e.setAttribute(p,n.id),i&&(t+="\n/*# sourceURL="+i.sources[0]+" */",t+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */"),e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},900:function(e){e.exports=function e(n,t,r){function i(a,s){if(!t[a]){if(!n[a]){if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var d=t[a]={exports:{}};n[a][0].call(d.exports,(function(e){return i(n[a][1][e]||e)}),d,d.exports,e,n,t,r)}return t[a].exports}for(var o=void 0,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,n,t){"use strict";var r={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},r.splitSections=function(e){return e.split("\nm=").map((function(e,n){return(n>0?"m="+e:e).trim()+"\r\n"}))},r.matchPrefix=function(e,n){return r.splitLines(e).filter((function(e){return 0===e.indexOf(n)}))},r.parseCandidate=function(e){for(var n,t={foundation:(n=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:n[1],protocol:n[2].toLowerCase(),priority:parseInt(n[3],10),ip:n[4],port:parseInt(n[5],10),type:n[7]},r=8;r<n.length;r+=2)switch(n[r]){case"raddr":t.relatedAddress=n[r+1];break;case"rport":t.relatedPort=parseInt(n[r+1],10);break;case"tcptype":t.tcpType=n[r+1]}return t},r.writeCandidate=function(e){var n=[];n.push(e.foundation),n.push(e.component),n.push(e.protocol.toUpperCase()),n.push(e.priority),n.push(e.ip),n.push(e.port);var t=e.type;return n.push("typ"),n.push(t),"host"!==t&&e.relatedAddress&&e.relatedPort&&(n.push("raddr"),n.push(e.relatedAddress),n.push("rport"),n.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(n.push("tcptype"),n.push(e.tcpType)),"candidate:"+n.join(" ")},r.parseRtpMap=function(e){var n=e.substr(9).split(" "),t={payloadType:parseInt(n.shift(),10)};return n=n[0].split("/"),t.name=n[0],t.clockRate=parseInt(n[1],10),t.numChannels=3===n.length?parseInt(n[2],10):1,t},r.writeRtpMap=function(e){var n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),"a=rtpmap:"+n+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},r.parseExtmap=function(e){var n=e.substr(9).split(" ");return{id:parseInt(n[0],10),uri:n[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var n,t={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)t[(n=r[i].trim().split("="))[0].trim()]=n[1];return t},r.writeFmtp=function(e){var n="",t=e.payloadType;if(void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach((function(n){r.push(n+"="+e.parameters[n])})),n+="a=fmtp:"+t+" "+r.join(";")+"\r\n"}return n},r.parseRtcpFb=function(e){var n=e.substr(e.indexOf(" ")+1).split(" ");return{type:n.shift(),parameter:n.join(" ")}},r.writeRtcpFb=function(e){var n="",t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){n+="a=rtcp-fb:"+t+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),n},r.parseSsrcMedia=function(e){var n=e.indexOf(" "),t={ssrc:parseInt(e.substr(7,n-7),10)},r=e.indexOf(":",n);return r>-1?(t.attribute=e.substr(n+1,r-n-1),t.value=e.substr(r+1)):t.attribute=e.substr(n+1),t},r.getDtlsParameters=function(e,n){var t=r.splitLines(e),i=(t=t.concat(r.splitLines(n))).filter((function(e){return 0===e.indexOf("a=fingerprint:")}))[0].substr(14);return{role:"auto",fingerprints:[{algorithm:i.split(" ")[0],value:i.split(" ")[1]}]}},r.writeDtlsParameters=function(e,n){var t="a=setup:"+n+"\r\n";return e.fingerprints.forEach((function(e){t+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),t},r.getIceParameters=function(e,n){var t=r.splitLines(e);return{usernameFragment:(t=t.concat(r.splitLines(n))).filter((function(e){return 0===e.indexOf("a=ice-ufrag:")}))[0].substr(12),password:t.filter((function(e){return 0===e.indexOf("a=ice-pwd:")}))[0].substr(10)}},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},t=r.splitLines(e)[0].split(" "),i=3;i<t.length;i++){var o=t[i],a=r.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){var s=r.parseRtpMap(a),c=r.matchPrefix(e,"a=fmtp:"+o+" ");switch(s.parameters=c.length?r.parseFmtp(c[0]):{},s.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(r.parseRtcpFb),n.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(s.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach((function(e){n.headerExtensions.push(r.parseExtmap(e))})),n},r.writeRtpDescription=function(e,n){var t="";return t+="m="+e+" ",t+=n.codecs.length>0?"9":"0",t+=" UDP/TLS/RTP/SAVPF ",t+=n.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",t+="c=IN IP4 0.0.0.0\r\n",t+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((function(e){t+=r.writeRtpMap(e),t+=r.writeFmtp(e),t+=r.writeRtcpFb(e)})),t+="a=rtcp-mux\r\n"},r.parseRtpEncodingParameters=function(e){var n,t=[],i=r.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=r.matchPrefix(e,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=s.length>0&&s[0].ssrc,d=r.matchPrefix(e,"a=ssrc-group:FID").map((function(e){var n=e.split(" ");return n.shift(),n.map((function(e){return parseInt(e,10)}))}));d.length>0&&d[0].length>1&&d[0][0]===c&&(n=d[0][1]),i.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{payloadType:e.payloadType,ssrc:n}};t.push(r),o&&((r=JSON.parse(JSON.stringify(r))).fec={ssrc:n,mechanism:a?"red+ulpfec":"red"},t.push(r))}})),0===t.length&&c&&t.push({ssrc:c});var l=r.matchPrefix(e,"b=");return l.length&&(0===l[0].indexOf("b=TIAS:")?l=parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")&&(l=parseInt(l[0].substr(5),10)),t.forEach((function(e){e.maxBitrate=l}))),t},r.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,n,t,i){var o=r.writeRtpDescription(e.kind,n);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===t?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a}return o+"a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n"},r.getDirection=function(e,n){for(var t=r.splitLines(e),i=0;i<t.length;i++)switch(t[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return t[i].substr(2)}return n?r.getDirection(n):"sendrecv"},n.exports=r},{}],2:[function(e,n,t){"use strict";!function(){var t=e("./utils").log,r=e("./utils").browserDetails;n.exports.browserDetails=r,n.exports.extractVersion=e("./utils").extractVersion,n.exports.disableLog=e("./utils").disableLog;var i=e("./chrome/chrome_shim")||null,o=e("./edge/edge_shim")||null,a=e("./firefox/firefox_shim")||null,s=e("./safari/safari_shim")||null;switch(r.browser){case"opera":case"chrome":if(!i||!i.shimPeerConnection)return void t("Chrome shim is not included in this adapter release.");t("adapter.js shimming chrome."),n.exports.browserShim=i,i.shimGetUserMedia(),i.shimMediaStream(),i.shimSourceObject(),i.shimPeerConnection(),i.shimOnTrack();break;case"firefox":if(!a||!a.shimPeerConnection)return void t("Firefox shim is not included in this adapter release.");t("adapter.js shimming firefox."),n.exports.browserShim=a,a.shimGetUserMedia(),a.shimSourceObject(),a.shimPeerConnection(),a.shimOnTrack();break;case"edge":if(!o||!o.shimPeerConnection)return void t("MS edge shim is not included in this adapter release.");t("adapter.js shimming edge."),n.exports.browserShim=o,o.shimGetUserMedia(),o.shimPeerConnection();break;case"safari":if(!s)return void t("Safari shim is not included in this adapter release.");t("adapter.js shimming safari."),n.exports.browserShim=s,s.shimGetUserMedia();break;default:t("Unsupported browser!")}}()},{"./chrome/chrome_shim":3,"./edge/edge_shim":5,"./firefox/firefox_shim":7,"./safari/safari_shim":9,"./utils":10}],3:[function(e,n,t){"use strict";var r=e("../utils.js").log,i=e("../utils.js").browserDetails,o={shimMediaStream:function(){window.MediaStream=window.MediaStream||window.webkitMediaStream},shimOnTrack:function(){"object"==typeof window&&window.RTCPeerConnection&&!("ontrack"in window.RTCPeerConnection.prototype)&&Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){var n=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.addEventListener("addtrack",(function(t){var r=new Event("track");r.track=t.track,r.receiver={track:t.track},r.streams=[e.stream],n.dispatchEvent(r)})),e.stream.getTracks().forEach(function(n){var t=new Event("track");t.track=n,t.receiver={track:n},t.streams=[e.stream],this.dispatchEvent(t)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&window.HTMLMediaElement&&!("srcObject"in window.HTMLMediaElement.prototype)&&Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var n=this;this._srcObject=e,this.src&&URL.revokeObjectURL(this.src),e?(this.src=URL.createObjectURL(e),e.addEventListener("addtrack",(function(){n.src&&URL.revokeObjectURL(n.src),n.src=URL.createObjectURL(e)})),e.addEventListener("removetrack",(function(){n.src&&URL.revokeObjectURL(n.src),n.src=URL.createObjectURL(e)}))):this.src=""}})},shimPeerConnection:function(){window.RTCPeerConnection=function(e,n){r("PeerConnection"),e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy);var t=new webkitRTCPeerConnection(e,n);return t.getStats.bind(t),t},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return webkitRTCPeerConnection.generateCertificate}}),["createOffer","createAnswer"].forEach((function(e){var n=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var t=1===arguments.length?arguments[0]:void 0;return new Promise((function(r,i){n.apply(e,[r,i,t])}))}return n.apply(this,arguments)}})),i.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(e){var n=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=arguments,t=this,r=new Promise((function(r,i){n.apply(t,[e[0],r,i])}));return e.length<2?r:r.then((function(){e[1].apply(null,[])}),(function(n){e.length>=3&&e[2].apply(null,[n])}))}})),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(e){var n=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}}));var e=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return null===arguments[0]?Promise.resolve():e.apply(this,arguments)}}};n.exports={shimMediaStream:o.shimMediaStream,shimOnTrack:o.shimOnTrack,shimSourceObject:o.shimSourceObject,shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils.js":10,"./getusermedia":4}],4:[function(e,n,t){"use strict";var r=e("../utils.js").log;n.exports=function(){var e=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var n={};return Object.keys(e).forEach((function(t){if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){var r="object"==typeof e[t]?e[t]:{ideal:e[t]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i=function(e,n){return e?e+n.charAt(0).toUpperCase()+n.slice(1):"deviceId"===n?"sourceId":n};if(void 0!==r.ideal){n.optional=n.optional||[];var o={};"number"==typeof r.ideal?(o[i("min",t)]=r.ideal,n.optional.push(o),(o={})[i("max",t)]=r.ideal,n.optional.push(o)):(o[i("",t)]=r.ideal,n.optional.push(o))}void 0!==r.exact&&"number"!=typeof r.exact?(n.mandatory=n.mandatory||{},n.mandatory[i("",t)]=r.exact):["min","max"].forEach((function(e){void 0!==r[e]&&(n.mandatory=n.mandatory||{},n.mandatory[i(e,t)]=r[e])}))}})),e.advanced&&(n.optional=(n.optional||[]).concat(e.advanced)),n},n=function(n,t){if((n=JSON.parse(JSON.stringify(n)))&&n.audio&&(n.audio=e(n.audio)),n&&"object"==typeof n.video){var i=n.video.facingMode;if((i=i&&("object"==typeof i?i:{ideal:i}))&&("user"===i.exact||"environment"===i.exact||"user"===i.ideal||"environment"===i.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode)&&(delete n.video.facingMode,"environment"===i.exact||"environment"===i.ideal))return navigator.mediaDevices.enumerateDevices().then((function(o){var a=(o=o.filter((function(e){return"videoinput"===e.kind}))).find((function(e){return-1!==e.label.toLowerCase().indexOf("back")}))||o.length&&o[o.length-1];return a&&(n.video.deviceId=i.exact?{exact:a.deviceId}:{ideal:a.deviceId}),n.video=e(n.video),r("chrome: "+JSON.stringify(n)),t(n)}));n.video=e(n.video)}return r("chrome: "+JSON.stringify(n)),t(n)},t=function(e){return{name:{PermissionDeniedError:"NotAllowedError",ConstraintNotSatisfiedError:"OverconstrainedError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};navigator.getUserMedia=function(e,r,i){n(e,(function(e){navigator.webkitGetUserMedia(e,r,(function(e){i(t(e))}))}))};var i=function(e){return new Promise((function(n,t){navigator.getUserMedia(e,n,t)}))};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:i,enumerateDevices:function(){return new Promise((function(e){var n={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources((function(t){e(t.map((function(e){return{label:e.label,kind:n[e.kind],deviceId:e.id,groupId:""}})))}))}))}}),navigator.mediaDevices.getUserMedia){var o=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return n(e,(function(e){return o(e).then((function(n){if(e.audio&&!n.getAudioTracks().length||e.video&&!n.getVideoTracks().length)throw n.getTracks().forEach((function(e){e.stop()})),new DOMException("","NotFoundError");return n}),(function(e){return Promise.reject(t(e))}))}))}}else navigator.mediaDevices.getUserMedia=function(e){return i(e)};void 0===navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){r("Dummy mediaDevices.addEventListener called.")}),void 0===navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){r("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":10}],5:[function(e,n,t){"use strict";var r=e("sdp"),i=e("../utils").browserDetails,o={shimPeerConnection:function(){window.RTCIceGatherer&&(window.RTCIceCandidate||(window.RTCIceCandidate=function(e){return e}),window.RTCSessionDescription||(window.RTCSessionDescription=function(e){return e})),window.RTCPeerConnection=function(e){var n=this,t=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){n[e]=t[e].bind(t)})),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return n.localStreams},this.getRemoteStreams=function(){return n.remoteStreams},this.localDescription=new RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},e&&e.iceTransportPolicy)switch(e.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=e.iceTransportPolicy;break;case"none":throw new TypeError('iceTransportPolicy "none" not supported')}if(this.usingBundle=e&&"max-bundle"===e.bundlePolicy,e&&e.iceServers){var r=JSON.parse(JSON.stringify(e.iceServers));this.iceOptions.iceServers=r.filter((function(e){if(e&&e.urls){var n=e.urls;return"string"==typeof n&&(n=[n]),!!(n=n.filter((function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")||0===e.indexOf("stun:")&&i.version>=14393}))[0])}return!1}))}this.transceivers=[],this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var e=this,n=r.splitSections(e.localDescription.sdp);this._localIceCandidatesBuffer.forEach((function(t){if(t.candidate&&0!==Object.keys(t.candidate).length)-1===t.candidate.candidate.indexOf("typ endOfCandidates")&&(n[t.candidate.sdpMLineIndex+1]+="a="+t.candidate.candidate+"\r\n");else for(var r=1;r<n.length;r++)-1===n[r].indexOf("\r\na=end-of-candidates\r\n")&&(n[r]+="a=end-of-candidates\r\n");e.localDescription.sdp=n.join(""),e.dispatchEvent(t),null!==e.onicecandidate&&e.onicecandidate(t),t.candidate||"complete"===e.iceGatheringState||e.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}))&&(e.iceGatheringState="complete")})),this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype.addStream=function(e){this.localStreams.push(e.clone()),this._maybeFireNegotiationNeeded()},window.RTCPeerConnection.prototype.removeStream=function(e){var n=this.localStreams.indexOf(e);n>-1&&(this.localStreams.splice(n,1),this._maybeFireNegotiationNeeded())},window.RTCPeerConnection.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},window.RTCPeerConnection.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},window.RTCPeerConnection.prototype._getCommonCapabilities=function(e,n){var t={codecs:[],headerExtensions:[],fecMechanisms:[]};return e.codecs.forEach((function(e){for(var r=0;r<n.codecs.length;r++){var i=n.codecs[r];if(e.name.toLowerCase()===i.name.toLowerCase()&&e.clockRate===i.clockRate&&e.numChannels===i.numChannels){t.codecs.push(i),i.rtcpFeedback=i.rtcpFeedback.filter((function(n){for(var t=0;t<e.rtcpFeedback.length;t++)if(e.rtcpFeedback[t].type===n.type&&e.rtcpFeedback[t].parameter===n.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var r=0;r<n.headerExtensions.length;r++){var i=n.headerExtensions[r];if(e.uri===i.uri){t.headerExtensions.push(i);break}}})),t},window.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(e,n){var t=this,i=new RTCIceGatherer(t.iceOptions),o=new RTCIceTransport(i);i.onlocalcandidate=function(a){var s=new Event("icecandidate");s.candidate={sdpMid:e,sdpMLineIndex:n};var c=a.candidate,d=!c||0===Object.keys(c).length;d?(void 0===i.state&&(i.state="completed"),s.candidate.candidate="candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates"):(c.component="RTCP"===o.component?2:1,s.candidate.candidate=r.writeCandidate(c));var l=r.splitSections(t.localDescription.sdp);-1===s.candidate.candidate.indexOf("typ endOfCandidates")?l[s.candidate.sdpMLineIndex+1]+="a="+s.candidate.candidate+"\r\n":l[s.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n",t.localDescription.sdp=l.join("");var u=t.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}));switch(t.iceGatheringState){case"new":t._localIceCandidatesBuffer.push(s),d&&u&&t._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":t._emitBufferedCandidates(),t.dispatchEvent(s),null!==t.onicecandidate&&t.onicecandidate(s),u&&(t.dispatchEvent(new Event("icecandidate")),null!==t.onicecandidate&&t.onicecandidate(new Event("icecandidate")),t.iceGatheringState="complete")}},o.onicestatechange=function(){t._updateConnectionState()};var a=new RTCDtlsTransport(o);return a.ondtlsstatechange=function(){t._updateConnectionState()},a.onerror=function(){a.state="failed",t._updateConnectionState()},{iceGatherer:i,iceTransport:o,dtlsTransport:a}},window.RTCPeerConnection.prototype._transceive=function(e,n,t){var i=this._getCommonCapabilities(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(i.encodings=e.sendEncodingParameters,i.rtcp={cname:r.localCName},e.recvEncodingParameters.length&&(i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(i)),t&&e.rtpReceiver&&("video"===e.kind&&e.recvEncodingParameters&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),i.encodings=e.recvEncodingParameters,i.rtcp={cname:e.cname},e.sendEncodingParameters.length&&(i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(i))},window.RTCPeerConnection.prototype.setLocalDescription=function(e){var n,t,i=this;if("offer"===e.type)this._pendingOffer&&(n=r.splitSections(e.sdp),t=n.shift(),n.forEach((function(e,n){var t=r.parseRtpParameters(e);i._pendingOffer[n].localCapabilities=t})),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===e.type){n=r.splitSections(i.remoteDescription.sdp),t=n.shift();var o=r.matchPrefix(t,"a=ice-lite").length>0;n.forEach((function(e,n){var a=i.transceivers[n],s=a.iceGatherer,c=a.iceTransport,d=a.dtlsTransport,l=a.localCapabilities,u=a.remoteCapabilities;if("0"!==e.split("\n",1)[0].split(" ",2)[1]&&!a.isDatachannel){var p=r.getIceParameters(e,t);if(o){var f=r.matchPrefix(e,"a=candidate:").map((function(e){return r.parseCandidate(e)})).filter((function(e){return"1"===e.component}));f.length&&c.setRemoteCandidates(f)}var v=r.getDtlsParameters(e,t);o&&(v.role="server"),i.usingBundle&&0!==n||(c.start(s,p,o?"controlling":"controlled"),d.start(v));var m=i._getCommonCapabilities(l,u);i._transceive(a,m.codecs.length>0,!1)}}))}switch(this.localDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}var a=arguments.length>1&&"function"==typeof arguments[1];if(a){var s=arguments[1];window.setTimeout((function(){s(),"new"===i.iceGatheringState&&(i.iceGatheringState="gathering"),i._emitBufferedCandidates()}),0)}var c=Promise.resolve();return c.then((function(){a||("new"===i.iceGatheringState&&(i.iceGatheringState="gathering"),window.setTimeout(i._emitBufferedCandidates.bind(i),500))})),c},window.RTCPeerConnection.prototype.setRemoteDescription=function(e){var n=this,t=new MediaStream,i=[],o=r.splitSections(e.sdp),a=o.shift(),s=r.matchPrefix(a,"a=ice-lite").length>0;switch(this.usingBundle=r.matchPrefix(a,"a=group:BUNDLE ").length>0,o.forEach((function(o,c){var d=r.splitLines(o)[0].substr(2).split(" "),l=d[0],u="0"===d[1],p=r.getDirection(o,a),f=r.matchPrefix(o,"a=mid:");if(f=f.length?f[0].substr(6):r.generateIdentifier(),"application"!==l||"DTLS/SCTP"!==d[2]){var v,m,g,h,w,b,y,S,C,k,T,x,R,D=r.parseRtpParameters(o);u||(T=r.getIceParameters(o,a),(x=r.getDtlsParameters(o,a)).role="client"),S=r.parseRtpEncodingParameters(o);var P=r.matchPrefix(o,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];P&&(R=P.value);var E=r.matchPrefix(o,"a=end-of-candidates",a).length>0,A=r.matchPrefix(o,"a=candidate:").map((function(e){return r.parseCandidate(e)})).filter((function(e){return"1"===e.component}));if("offer"!==e.type||u)"answer"!==e.type||u||(m=(v=n.transceivers[c]).iceGatherer,g=v.iceTransport,h=v.dtlsTransport,w=v.rtpSender,b=v.rtpReceiver,y=v.sendEncodingParameters,C=v.localCapabilities,n.transceivers[c].recvEncodingParameters=S,n.transceivers[c].remoteCapabilities=D,n.transceivers[c].cname=R,(s||E)&&A.length&&g.setRemoteCandidates(A),n.usingBundle&&0!==c||(g.start(m,T,"controlling"),h.start(x)),n._transceive(v,"sendrecv"===p||"recvonly"===p,"sendrecv"===p||"sendonly"===p),!b||"sendrecv"!==p&&"sendonly"!==p?delete v.rtpReceiver:(k=b.track,i.push([k,b]),t.addTrack(k)));else{var I,_=n.usingBundle&&c>0?{iceGatherer:n.transceivers[0].iceGatherer,iceTransport:n.transceivers[0].iceTransport,dtlsTransport:n.transceivers[0].dtlsTransport}:n._createIceAndDtlsTransports(f,c);E&&_.iceTransport.setRemoteCandidates(A),(C=RTCRtpReceiver.getCapabilities(l)).codecs=C.codecs.filter((function(e){return"rtx"!==e.name})),y=[{ssrc:1001*(2*c+2)}],k=(b=new RTCRtpReceiver(_.dtlsTransport,l)).track,i.push([k,b]),t.addTrack(k),n.localStreams.length>0&&n.localStreams[0].getTracks().length>=c&&("audio"===l?I=n.localStreams[0].getAudioTracks()[0]:"video"===l&&(I=n.localStreams[0].getVideoTracks()[0]),I&&(w=new RTCRtpSender(I,_.dtlsTransport))),n.transceivers[c]={iceGatherer:_.iceGatherer,iceTransport:_.iceTransport,dtlsTransport:_.dtlsTransport,localCapabilities:C,remoteCapabilities:D,rtpSender:w,rtpReceiver:b,kind:l,mid:f,cname:R,sendEncodingParameters:y,recvEncodingParameters:S},n._transceive(n.transceivers[c],!1,"sendrecv"===p||"sendonly"===p)}}else n.transceivers[c]={mid:f,isDatachannel:!0}})),this.remoteDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}return t.getTracks().length&&(n.remoteStreams.push(t),window.setTimeout((function(){var e=new Event("addstream");e.stream=t,n.dispatchEvent(e),null!==n.onaddstream&&window.setTimeout((function(){n.onaddstream(e)}),0),i.forEach((function(r){var i=r[0],o=r[1],a=new Event("track");a.track=i,a.receiver=o,a.streams=[t],n.dispatchEvent(e),null!==n.ontrack&&window.setTimeout((function(){n.ontrack(a)}),0)}))}),0)),arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._updateSignalingState("closed")},window.RTCPeerConnection.prototype._updateSignalingState=function(e){this.signalingState=e;var n=new Event("signalingstatechange");this.dispatchEvent(n),null!==this.onsignalingstatechange&&this.onsignalingstatechange(n)},window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){var e=new Event("negotiationneeded");this.dispatchEvent(e),null!==this.onnegotiationneeded&&this.onnegotiationneeded(e)},window.RTCPeerConnection.prototype._updateConnectionState=function(){var e,n={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};if(this.transceivers.forEach((function(e){n[e.iceTransport.state]++,n[e.dtlsTransport.state]++})),n.connected+=n.completed,e="new",n.failed>0?e="failed":n.connecting>0||n.checking>0?e="connecting":n.disconnected>0?e="disconnected":n.new>0?e="new":(n.connected>0||n.completed>0)&&(e="connected"),e!==this.iceConnectionState){this.iceConnectionState=e;var t=new Event("iceconnectionstatechange");this.dispatchEvent(t),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(t)}},window.RTCPeerConnection.prototype.createOffer=function(){var e,n=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");1===arguments.length&&"function"!=typeof arguments[0]?e=arguments[0]:3===arguments.length&&(e=arguments[2]);var t=[],i=0,o=0;if(this.localStreams.length&&(i=this.localStreams[0].getAudioTracks().length,o=this.localStreams[0].getVideoTracks().length),e){if(e.mandatory||e.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==e.offerToReceiveAudio&&(i=e.offerToReceiveAudio),void 0!==e.offerToReceiveVideo&&(o=e.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach((function(e){t.push({kind:e.kind,track:e,wantReceive:"audio"===e.kind?i>0:o>0}),"audio"===e.kind?i--:"video"===e.kind&&o--}));i>0||o>0;)i>0&&(t.push({kind:"audio",wantReceive:!0}),i--),o>0&&(t.push({kind:"video",wantReceive:!0}),o--);var a=r.writeSessionBoilerplate(),s=[];t.forEach((function(e,t){var i,o,a=e.track,c=e.kind,d=r.generateIdentifier(),l=n.usingBundle&&t>0?{iceGatherer:s[0].iceGatherer,iceTransport:s[0].iceTransport,dtlsTransport:s[0].dtlsTransport}:n._createIceAndDtlsTransports(d,t),u=RTCRtpSender.getCapabilities(c);u.codecs=u.codecs.filter((function(e){return"rtx"!==e.name}));var p=[{ssrc:1001*(2*t+1)}];a&&(i=new RTCRtpSender(a,l.dtlsTransport)),e.wantReceive&&(o=new RTCRtpReceiver(l.dtlsTransport,c)),s[t]={iceGatherer:l.iceGatherer,iceTransport:l.iceTransport,dtlsTransport:l.dtlsTransport,localCapabilities:u,remoteCapabilities:null,rtpSender:i,rtpReceiver:o,kind:c,mid:d,sendEncodingParameters:p,recvEncodingParameters:null}})),this.usingBundle&&(a+="a=group:BUNDLE "+s.map((function(e){return e.mid})).join(" ")+"\r\n"),t.forEach((function(e,t){var i=s[t];a+=r.writeMediaSection(i,i.localCapabilities,"offer",n.localStreams[0])})),this._pendingOffer=s;var c=new RTCSessionDescription({type:"offer",sdp:a});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,c),Promise.resolve(c)},window.RTCPeerConnection.prototype.createAnswer=function(){var e=this,n=r.writeSessionBoilerplate();this.usingBundle&&(n+="a=group:BUNDLE "+this.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),this.transceivers.forEach((function(t){if(t.isDatachannel)n+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+t.mid+"\r\n";else{var i=e._getCommonCapabilities(t.localCapabilities,t.remoteCapabilities);n+=r.writeMediaSection(t,i,"answer",e.localStreams[0])}}));var t=new RTCSessionDescription({type:"answer",sdp:n});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,t),Promise.resolve(t)},window.RTCPeerConnection.prototype.addIceCandidate=function(e){if(null===e)this.transceivers.forEach((function(e){e.iceTransport.addRemoteCandidate({})}));else{var n=e.sdpMLineIndex;if(e.sdpMid)for(var t=0;t<this.transceivers.length;t++)if(this.transceivers[t].mid===e.sdpMid){n=t;break}var i=this.transceivers[n];if(i){var o=Object.keys(e.candidate).length>0?r.parseCandidate(e.candidate):{};if("tcp"===o.protocol&&(0===o.port||9===o.port))return;if("1"!==o.component)return;"endOfCandidates"===o.type&&(o={}),i.iceTransport.addRemoteCandidate(o);var a=r.splitSections(this.remoteDescription.sdp);a[n+1]+=(o.type?e.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=a.join("")}}return arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.getStats=function(){var e=[];this.transceivers.forEach((function(n){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(t){n[t]&&e.push(n[t].getStats())}))}));var n=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1];return new Promise((function(t){var r=new Map;Promise.all(e).then((function(e){e.forEach((function(e){Object.keys(e).forEach((function(n){r.set(n,e[n]),r[n]=e[n]}))})),n&&window.setTimeout(n,0,r),t(r)}))}))}}};n.exports={shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils":10,"./getusermedia":6,sdp:1}],6:[function(e,n,t){"use strict";n.exports=function(){var e=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(n){return e(n).catch((function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))}))}}},{}],7:[function(e,n,t){"use strict";var r=e("../utils").browserDetails,i={shimOnTrack:function(){"object"==typeof window&&window.RTCPeerConnection&&!("ontrack"in window.RTCPeerConnection.prototype)&&Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(n){var t=new Event("track");t.track=n,t.receiver={track:n},t.streams=[e.stream],this.dispatchEvent(t)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&window.HTMLMediaElement&&!("srcObject"in window.HTMLMediaElement.prototype)&&Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}})},shimPeerConnection:function(){if("object"==typeof window&&(window.RTCPeerConnection||window.mozRTCPeerConnection)){window.RTCPeerConnection||(window.RTCPeerConnection=function(e,n){if(r.version<38&&e&&e.iceServers){for(var t=[],i=0;i<e.iceServers.length;i++){var o=e.iceServers[i];if(o.hasOwnProperty("urls"))for(var a=0;a<o.urls.length;a++){var s={url:o.urls[a]};0===o.urls[a].indexOf("turn")&&(s.username=o.username,s.credential=o.credential),t.push(s)}else t.push(e.iceServers[i])}e.iceServers=t}return new mozRTCPeerConnection(e,n)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(e){var n=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}}));var e=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return null===arguments[0]?Promise.resolve():e.apply(this,arguments)};var n=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(e,t,r){return n.apply(this,[e||null]).then((function(e){return function(e){var n=new Map;return Object.keys(e).forEach((function(t){n.set(t,e[t]),n[t]=e[t]})),n}(e)})).then(t,r)}}}};n.exports={shimOnTrack:i.shimOnTrack,shimSourceObject:i.shimSourceObject,shimPeerConnection:i.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils":10,"./getusermedia":8}],8:[function(e,n,t){"use strict";var r=e("../utils").log,i=e("../utils").browserDetails;n.exports=function(){var e=function(e){return{name:{SecurityError:"NotAllowedError",PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},n=function(n,t,o){var a=function(e){if("object"!=typeof e||e.require)return e;var n=[];return Object.keys(e).forEach((function(t){if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){var r=e[t]="object"==typeof e[t]?e[t]:{ideal:e[t]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||n.push(t),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:e[t]=r.exact,delete r.exact),void 0!==r.ideal){e.advanced=e.advanced||[];var i={};"number"==typeof r.ideal?i[t]={min:r.ideal,max:r.ideal}:i[t]=r.ideal,e.advanced.push(i),delete r.ideal,Object.keys(r).length||delete e[t]}}})),n.length&&(e.require=n),e};return n=JSON.parse(JSON.stringify(n)),i.version<38&&(r("spec: "+JSON.stringify(n)),n.audio&&(n.audio=a(n.audio)),n.video&&(n.video=a(n.video)),r("ff37: "+JSON.stringify(n))),navigator.mozGetUserMedia(n,t,(function(n){o(e(n))}))};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:function(e){return new Promise((function(t,r){n(e,t,r)}))},addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise((function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])}))},i.version<41){var t=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return t().then(void 0,(function(e){if("NotFoundError"===e.name)return[];throw e}))}}if(i.version<49){var o=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(n){return o(n).then((function(e){if(n.audio&&!e.getAudioTracks().length||n.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((function(e){e.stop()})),new DOMException("The object can not be found here.","NotFoundError");return e}),(function(n){return Promise.reject(e(n))}))}}navigator.getUserMedia=function(e,t,r){if(i.version<44)return n(e,t,r);console.warn("navigator.getUserMedia has been replaced by navigator.mediaDevices.getUserMedia"),navigator.mediaDevices.getUserMedia(e).then(t,r)}}},{"../utils":10}],9:[function(e,n,t){"use strict";var r={shimGetUserMedia:function(){navigator.getUserMedia=navigator.webkitGetUserMedia}};n.exports={shimGetUserMedia:r.shimGetUserMedia}},{}],10:[function(e,n,t){"use strict";var r=!0,i={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(r=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},log:function(){if("object"==typeof window){if(r)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},extractVersion:function(e,n,t){var r=e.match(n);return r&&r.length>=t&&parseInt(r[t],10)},detectBrowser:function(){var e={browser:null,version:null};if("undefined"==typeof window||!window.navigator)return e.browser="Not a browser.",e;if(navigator.mozGetUserMedia)e.browser="firefox",e.version=this.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1);else if(navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)e.browser="chrome",e.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2);else{if(!navigator.userAgent.match(/Version\/(\d+).(\d+)/))return e.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",e;e.browser="safari",e.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/([0-9]+)\./,1)}else{if(!navigator.mediaDevices||!navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))return e.browser="Not a supported browser.",e;e.browser="edge",e.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2)}return e}};n.exports={log:i.log,disableLog:i.disableLog,browserDetails:i.detectBrowser(),extractVersion:i.extractVersion}},{}]},{},[2])(2)},508:function(n){"use strict";n.exports=e}},t={};function r(e){var i=t[e];if(void 0!==i)return i.exports;var o=t[e]={id:e,exports:{}};return n[e](o,o.exports,r),o.exports}r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,{a:n}),n},r.d=function(e,n){for(var t in n)r.o(n,t)&&!r.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},r.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return function(){"use strict";r.r(i),r.d(i,{PhoneButton:function(){return V},PhoneWidget:function(){return N}});var e=r(508);const n=n=>((0,e.pushScopeId)("data-v-0dae9322"),n=n(),(0,e.popScopeId)(),n),t={key:0,class:"phone-widget"},o={key:1,class:"phone-widget__dropdown-container"},a={class:"phone-widget__dropdown-minimize"},s=[n((()=>(0,e.createElementVNode)("path",{d:"M32 416c-17.7 0-32 14.3-32 32s14.3 32 32 32l448 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L32 416z"},null,-1)))],c={class:"phone-widget__dropdown-body"},d={class:"phone-widget__dropdown-advices-container"},l={key:0,class:"phone-widget__dropdown-advice-body phone-widget__dropdown-advice-idle"},u=n((()=>(0,e.createElementVNode)("p",null,"Estamos a un llamado de distancia",-1))),p=[n((()=>(0,e.createElementVNode)("svg",{class:"phone-widget__dropdown-advice-idle-circle-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},[(0,e.createElementVNode)("path",{fill:"#ffffff",d:"M164.9 24.6c-7.7-18.6-28-28.5-47.4-23.2l-88 24C12.1 30.2 0 46 0 64C0 311.4 200.6 512 448 512c18 0 33.8-12.1 38.6-29.5l24-88c5.3-19.4-4.6-39.7-23.2-47.4l-96-40c-16.3-6.8-35.2-2.1-46.3 11.6L304.7 368C234.3 334.7 177.3 277.7 144 207.3L193.3 167c13.7-11.2 18.4-30 11.6-46.3l-40-96z"})],-1)))],f={key:1,class:"phone-widget__dropdown-advice-body phone-widget__dropdown-advice-ringing"},v=[(0,e.createStaticVNode)('<div class="phone-widget__dropdown-top-advices-container" data-v-0dae9322><div class="phone-widget__dropdown-advice-calling" data-v-0dae9322><p data-v-0dae9322>Llamando</p><div class="phone-widget__dropdown-advice-calling-circle" data-v-0dae9322><svg class="phone-widget__dropdown-advice-calling-circle-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-v-0dae9322><path fill="#ffffff" d="M280 0C408.1 0 512 103.9 512 232c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-101.6-82.4-184-184-184c-13.3 0-24-10.7-24-24s10.7-24 24-24zm8 192a32 32 0 1 1 0 64 32 32 0 1 1 0-64zm-32-72c0-13.3 10.7-24 24-24c75.1 0 136 60.9 136 136c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-48.6-39.4-88-88-88c-13.3 0-24-10.7-24-24zM117.5 1.4c19.4-5.3 39.7 4.6 47.4 23.2l40 96c6.8 16.3 2.1 35.2-11.6 46.3L144 207.3c33.3 70.4 90.3 127.4 160.7 160.7L345 318.7c11.2-13.7 30-18.4 46.3-11.6l96 40c18.6 7.7 28.5 28 23.2 47.4l-24 88C481.8 499.9 466 512 448 512C200.6 512 0 311.4 0 64C0 46 12.1 30.2 29.5 25.4l88-24z" data-v-0dae9322></path></svg></div></div></div><div class="phone-widget__dropdown-headphones-advice" data-v-0dae9322><p data-v-0dae9322>Coloquese los auriculares para una mejor experiencia</p><svg class="phone-widget__dropdown-headphones-advice-image" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-v-0dae9322><path d="M256 80C149.9 80 62.4 159.4 49.6 262c9.4-3.8 19.6-6 30.4-6c26.5 0 48 21.5 48 48l0 128c0 26.5-21.5 48-48 48c-44.2 0-80-35.8-80-80l0-16 0-48 0-48C0 146.6 114.6 32 256 32s256 114.6 256 256l0 48 0 48 0 16c0 44.2-35.8 80-80 80c-26.5 0-48-21.5-48-48l0-128c0-26.5 21.5-48 48-48c10.8 0 21 2.1 30.4 6C449.6 159.4 362.1 80 256 80z" data-v-0dae9322></path></svg></div>',2)],m={key:2,class:"phone-widget__dropdown-advice-body phone-widget__dropdown-advice-in-call"},g=n((()=>(0,e.createElementVNode)("p",null,"En llamada",-1))),h={class:"phone-widget__dropdown-advice-in-call-circle"},w=[n((()=>(0,e.createElementVNode)("path",{fill:"#ffffff",d:"M164.9 24.6c-7.7-18.6-28-28.5-47.4-23.2l-88 24C12.1 30.2 0 46 0 64C0 311.4 200.6 512 448 512c18 0 33.8-12.1 38.6-29.5l24-88c5.3-19.4-4.6-39.7-23.2-47.4l-96-40c-16.3-6.8-35.2-2.1-46.3 11.6L304.7 368C234.3 334.7 177.3 277.7 144 207.3L193.3 167c13.7-11.2 18.4-30 11.6-46.3l-40-96z"},null,-1)))],b={ref:"sipAudioElement",autoplay:"",playsinline:"",loop:"",style:{display:"block"}};var y=r(900),S=r.n(y);k.sessions={},k.isExtensionEnabled=function(){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return!0;if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),n=33;return window.navigator.userAgent.match("Linux")&&(n=35),e>=26&&e<=n||k.extension.isInstalled()}return!0};var C={extensionId:"hapfgfdkleiggjjpfpenajgdnfckjpaj",isInstalled:function(){return null!==document.querySelector("#janus-extension-installed")},getScreen:function(e){var n=window.setTimeout((function(){var n=new Error("NavigatorUserMediaError");return n.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',e(n)}),1e3);this.cache[n]=e,window.postMessage({type:"janusGetScreen",id:n},"*")},init:function(){var e={};this.cache=e,window.addEventListener("message",(function(n){if(n.origin==window.location.origin)if("janusGotScreen"==n.data.type&&e[n.data.id]){var t=e[n.data.id];if(delete e[n.data.id],""===n.data.sourceId){var r=new Error("NavigatorUserMediaError");r.name="You cancelled the request for permission, giving up...",t(r)}else t(null,n.data.sourceId)}else"janusGetScreenPending"==n.data.type&&(console.log("clearing ",n.data.id),window.clearTimeout(n.data.id))}))}};function k(e){if((e=e||{}).success="function"==typeof e.success?e.success:k.noop,e.error="function"==typeof e.error?e.error:k.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:k.noop,!k.initDone)return e.error("Library not initialized"),{};if(!k.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(k.log("Library initialized: "+k.initDone),!e.server)return e.error("Invalid server url"),{};var n=!1,t=null,r={},i=null,o=null,a=0,s=e.server;k.isArray(s)?(k.log("Multiple servers provided ("+s.length+"), will use the first that works"),s=null,o=e.server,k.debug(o)):0===s.indexOf("ws")?(n=!0,k.log("Using WebSockets to contact Janus: "+s)):(n=!1,k.log("Using REST API to contact Janus: "+s));var c=e.iceServers||[{urls:"stun:stun.l.google.com:19302"}],d=e.iceTransportPolicy,l=e.bundlePolicy,u=!0===e.ipv6,p=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(p=!0===e.withCredentials);var f=10;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(f=e.max_poll_events),f<1&&(f=1);var v=null;void 0!==e.token&&null!==e.token&&(v=e.token);var m=null;void 0!==e.apisecret&&null!==e.apisecret&&(m=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var g=25e3;void 0!==e.keepAlivePeriod&&null!==e.keepAlivePeriod&&(g=e.keepAlivePeriod),isNaN(g)&&(g=25e3);var h=6e4;function w(e){var n={high:9e5,medium:3e5,low:1e5};return null!=e&&(e.high&&(n.high=e.high),e.medium&&(n.medium=e.medium),e.low&&(n.low=e.low)),n}void 0!==e.longPollTimeout&&null!==e.longPollTimeout&&(h=e.longPollTimeout),isNaN(h)&&(h=6e4);var b=!1,y=null,S={},C=this,T=0,x={};function R(){if(null!=y)if(k.debug("Long poll..."),b){var n=s+"/"+y+"?rid="+(new Date).getTime();f&&(n=n+"&maxev="+f),v&&(n=n+"&token="+encodeURIComponent(v)),m&&(n=n+"&apisecret="+encodeURIComponent(m)),k.httpAPICall(n,{verb:"GET",withCredentials:p,success:D,timeout:h,error:function(n,t){if(k.error(n+":",t),++T>3)return b=!1,void e.error("Lost connection to the server (is it down?)");R()}})}else k.warn("Is the server down? (connected=false)")}function D(e,r){if(T=0,n||null==y||!0===r||R(),n||!k.isArray(e))if("keepalive"!==e.janus)if("server_info"!==e.janus)if("ack"!==e.janus)if("success"!==e.janus)if("trickle"===e.janus){if(!(c=e.sender))return void k.warn("Missing sender...");if(!(l=S[c]))return void k.debug("This handle is not attached to this session");var i=e.candidate;k.debug("Got a trickled candidate on session "+y),k.debug(i);var o=l.webrtcStuff;o.pc&&o.remoteSdp?(k.debug("Adding remote candidate:",i),i&&!0!==i.completed?o.pc.addIceCandidate(i):o.pc.addIceCandidate(k.endOfCandidates)):(k.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),o.candidates||(o.candidates=[]),o.candidates.push(i),k.debug(o.candidates))}else{if("webrtcup"===e.janus)return k.debug("Got a webrtcup event on session "+y),k.debug(e),(c=e.sender)?(l=S[c])?void l.webrtcState(!0):void k.debug("This handle is not attached to this session"):void k.warn("Missing sender...");if("hangup"===e.janus){if(k.debug("Got a hangup event on session "+y),k.debug(e),!(c=e.sender))return void k.warn("Missing sender...");if(!(l=S[c]))return void k.debug("This handle is not attached to this session");l.webrtcState(!1,e.reason),l.hangup()}else if("detached"===e.janus){if(k.debug("Got a detached event on session "+y),k.debug(e),!(c=e.sender))return void k.warn("Missing sender...");if(!(l=S[c]))return;l.detached=!0,l.ondetached(),l.detach()}else if("media"===e.janus){if(k.debug("Got a media event on session "+y),k.debug(e),!(c=e.sender))return void k.warn("Missing sender...");if(!(l=S[c]))return void k.debug("This handle is not attached to this session");l.mediaState(e.type,e.receiving)}else if("slowlink"===e.janus){if(k.debug("Got a slowlink event on session "+y),k.debug(e),!(c=e.sender))return void k.warn("Missing sender...");if(!(l=S[c]))return void k.debug("This handle is not attached to this session");l.slowLink(e.uplink,e.lost)}else{var a,s;if("error"===e.janus)return k.error("Ooops: "+e.error.code+" "+e.error.reason),k.debug(e),void((a=e.transaction)&&((s=x[a])&&s(e),delete x[a]));if("event"===e.janus){var c;if(k.debug("Got a plugin event on session "+y),k.debug(e),!(c=e.sender))return void k.warn("Missing sender...");var d=e.plugindata;if(!d)return void k.warn("Missing plugindata...");k.debug("  -- Event is coming from "+c+" ("+d.plugin+")");var l,u=d.data;if(k.debug(u),!(l=S[c]))return void k.warn("This handle is not attached to this session");var p=e.jsep;p&&(k.debug("Handling SDP as well..."),k.debug(p));var f=l.onmessage;f?(k.debug("Notifying application..."),f(u,p,e)):k.debug("No provided notification callback")}else{if("timeout"===e.janus)return k.error("Timeout on session "+y),k.debug(e),void(n&&t.close(3504,"Gateway timeout"));k.warn("Unknown message/event  '"+e.janus+"' on session "+y),k.debug(e)}}}else k.debug("Got a success on session "+y),k.debug(e),(a=e.transaction)&&((s=x[a])&&s(e),delete x[a]);else k.debug("Got an ack on session "+y),k.debug(e),(a=e.transaction)&&((s=x[a])&&s(e),delete x[a]);else k.debug("Got info on the Janus instance"),k.debug(e),(a=e.transaction)&&((s=x[a])&&s(e),delete x[a]);else k.debug("Got a keepalive on session "+y);else for(var v=0;v<e.length;v++)D(e[v],!0)}function P(){if(s&&n&&b){i=setTimeout(P,g);var e={janus:"keepalive",session_id:y,transaction:k.randomString(12)};v&&(e.token=v),m&&(e.apisecret=m),t.send(JSON.stringify(e))}}function E(c){var d=k.randomString(12),l={janus:"create",transaction:d};if(c.reconnect&&(b=!1,l.janus="claim",l.session_id=y,t&&(t.onopen=null,t.onerror=null,t.onclose=null,i&&(clearTimeout(i),i=null))),v&&(l.token=v),m&&(l.apisecret=m),!s&&k.isArray(o)&&(0===(s=o[a]).indexOf("ws")?(n=!0,k.log("Server #"+(a+1)+": trying WebSockets to contact Janus ("+s+")")):(n=!1,k.log("Server #"+(a+1)+": trying REST API to contact Janus ("+s+")"))),n)for(var u in t=k.newWebSocket(s,"janus-protocol"),r={error:function(){if(k.error("Error connecting to the Janus WebSockets server... "+s),k.isArray(o)&&!c.reconnect)return++a===o.length?void c.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout((function(){E(c)}),200));c.error("Error connecting to the Janus WebSockets server: Is the server down?")},open:function(){x[d]=function(e){if(k.debug(e),"success"!==e.janus)return k.error("Ooops: "+e.error.code+" "+e.error.reason),void c.error(e.error.reason);i=setTimeout(P,g),b=!0,y=e.session_id?e.session_id:e.data.id,c.reconnect?k.log("Claimed session: "+y):k.log("Created session: "+y),k.sessions[y]=C,c.success()},t.send(JSON.stringify(l))},message:function(e){D(JSON.parse(e.data))},close:function(){s&&b&&(b=!1,e.error("Lost connection to the server (is it down?)"))}})t.addEventListener(u,r[u]);else k.httpAPICall(s,{verb:"POST",withCredentials:p,body:l,success:function(e){if(k.debug(e),"success"!==e.janus)return k.error("Ooops: "+e.error.code+" "+e.error.reason),void c.error(e.error.reason);b=!0,y=e.session_id?e.session_id:e.data.id,c.reconnect?k.log("Claimed session: "+y):k.log("Created session: "+y),k.sessions[y]=C,R(),c.success()},error:function(e,n){if(k.error(e+":",n),k.isArray(o)&&!c.reconnect)return++a===o.length?void c.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout((function(){E(c)}),200));""===n?c.error(e+": Is the server down?"):c.error(e+": "+n)}})}function A(e,r){if((r=r||{}).success="function"==typeof r.success?r.success:k.noop,r.error="function"==typeof r.error?r.error:k.noop,!b)return console.warn("Is the server down? (connected=false)"),void r.error("Is the server down? (connected=false)");var i=S[e];if(!i||!i.webrtcStuff)return console.warn("Invalid handle"),void r.error("Invalid handle");var o=r.message,a=r.jsep,c=k.randomString(12),d={janus:"message",body:o,transaction:c};if(i.token&&(d.token=i.token),m&&(d.apisecret=m),a&&(d.jsep={type:a.type,sdp:a.sdp},a.e2ee&&(d.jsep.e2ee=!0),"hml"!==a.rid_order&&"lmh"!==a.rid_order||(d.jsep.rid_order=a.rid_order)),n)return d.session_id=y,d.handle_id=e,x[c]=function(e){if("success"!==e.janus)"ack"===e.janus?r.success():e.error?(console.error("Ooops: "+e.error.code+" "+e.error.reason),r.error(e.error.code+" "+e.error.reason)):(console.error("Unknown error"),r.error("Unknown error"));else{var n=e.plugindata;if(!n)return console.warn("Request succeeded, but missing plugindata..."),void r.success();var t=n.data;r.success(t)}},void t.send(JSON.stringify(d));k.httpAPICall(s+"/"+y+"/"+e,{verb:"POST",withCredentials:p,body:d,success:function(e){if("success"!==e.janus)"ack"===e.janus?r.success():e.error?(console.error("Ooops: "+e.error.code+" "+e.error.reason),r.error(e.error.code+" "+e.error.reason)):(console.error("Unknown error"),r.error("Unknown error"));else{var n=e.plugindata;if(!n)return console.warn("Request succeeded, but missing plugindata..."),void r.success();var t=n.data;r.success(t)}},error:function(e,n){console.error(e+":",n),r.error(e+": "+n)}})}function I(e,r){if(b){var i=S[e];if(i&&i.webrtcStuff){var o={janus:"trickle",candidate:r,transaction:k.randomString(12)};if(i.token&&(o.token=i.token),m&&(o.apisecret=m),k.vdebug("Sending trickle candidate (handle="+e+"):"),k.vdebug(o),n)return o.session_id=y,o.handle_id=e,void t.send(JSON.stringify(o));k.httpAPICall(s+"/"+y+"/"+e,{verb:"POST",withCredentials:p,body:o,success:function(e){k.vdebug("Candidate sent!"),k.vdebug(e),"ack"===e.janus||k.error("Ooops: "+e.error.code+" "+e.error.reason)},error:function(e,n){k.error(e+":",n)}})}else k.warn("Invalid handle")}else k.warn("Is the server down? (connected=false)")}function _(e,n,t,r,i){var o=S[e];if(o&&o.webrtcStuff){var a=o.webrtcStuff;if(a.pc){var s=function(e){k.log("Received state change on data channel:",e);var n=e.target.label,t=e.target.protocol,r=a.dataChannel[n]?a.dataChannel[n].readyState:"null";if(k.log("State change on <"+n+"> data channel: "+r),"open"===r){if(a.dataChannel[n].pending&&a.dataChannel[n].pending.length>0){for(var i of(k.log("Sending pending messages on <"+n+">:",a.dataChannel[n].pending.length),a.dataChannel[n].pending))k.log("Sending data on data channel <"+n+">"),k.debug(i),a.dataChannel[n].send(i);a.dataChannel[n].pending=[]}o.ondataopen(n,t)}};if(r)a.dataChannel[n]=r;else{var c={ordered:!0};t&&(c.protocol=t),a.dataChannel[n]=a.pc.createDataChannel(n,c)}a.dataChannel[n].onmessage=function(e){k.log("Received message on data channel:",e);var n=e.target.label;o.ondata(e.data,n)},a.dataChannel[n].onopen=s,a.dataChannel[n].onclose=s,a.dataChannel[n].onerror=function(e){k.error("Got error on data channel:",e)},a.dataChannel[n].pending=[],i&&a.dataChannel[n].pending.push(i)}else k.warn("Invalid PeerConnection")}else k.warn("Invalid handle")}function M(e,n){(n=n||{}).success="function"==typeof n.success?n.success:k.noop,n.error="function"==typeof n.error?n.error:k.noop;var t=S[e];if(!t||!t.webrtcStuff)return k.warn("Invalid handle"),void n.error("Invalid handle");var r=t.webrtcStuff,i=n.text||n.data;if(!i)return k.warn("Invalid data"),void n.error("Invalid data");var o=n.label?n.label:k.dataChanDefaultLabel;return r.dataChannel[o]?"open"!==r.dataChannel[o].readyState?(r.dataChannel[o].pending.push(i),void n.success()):(k.log("Sending data on data channel <"+o+">"),k.debug(i),r.dataChannel[o].send(i),void n.success()):(_(e,o,n.protocol,!1,i,n.protocol),void n.success())}function O(e,n){(n=n||{}).success="function"==typeof n.success?n.success:k.noop,n.error="function"==typeof n.error?n.error:k.noop;var t=S[e];if(!t||!t.webrtcStuff)return k.warn("Invalid handle"),void n.error("Invalid handle");var r=t.webrtcStuff;if(!r.dtmfSender){if(r.pc){var i=r.pc.getSenders().find((function(e){return e.track&&"audio"===e.track.kind}));if(!i)return k.warn("Invalid DTMF configuration (no audio track)"),void n.error("Invalid DTMF configuration (no audio track)");r.dtmfSender=i.dtmf,r.dtmfSender&&(k.log("Created DTMF Sender"),r.dtmfSender.ontonechange=function(e){k.debug("Sent DTMF tone: "+e.tone)})}if(!r.dtmfSender)return k.warn("Invalid DTMF configuration"),void n.error("Invalid DTMF configuration")}var o=n.dtmf;if(!o)return k.warn("Invalid DTMF parameters"),void n.error("Invalid DTMF parameters");var a=o.tones;if(!a)return k.warn("Invalid DTMF string"),void n.error("Invalid DTMF string");var s="number"==typeof o.duration?o.duration:500,c="number"==typeof o.gap?o.gap:50;k.debug("Sending DTMF string "+a+" (duration "+s+"ms, gap "+c+"ms)"),r.dtmfSender.insertDTMF(a,s,c),n.success()}function j(e,r){(r=r||{}).success="function"==typeof r.success?r.success:k.noop,r.error="function"==typeof r.error?r.error:k.noop;var i=!0===r.noRequest;k.log("Destroying handle "+e+" (only-locally="+i+")"),J(e);var o=S[e];if(!o||o.detached)return delete S[e],void r.success();if(i)return delete S[e],void r.success();if(!b)return k.warn("Is the server down? (connected=false)"),void r.error("Is the server down? (connected=false)");var a={janus:"detach",transaction:k.randomString(12)};if(o.token&&(a.token=o.token),m&&(a.apisecret=m),n)return a.session_id=y,a.handle_id=e,t.send(JSON.stringify(a)),delete S[e],void r.success();k.httpAPICall(s+"/"+y+"/"+e,{verb:"POST",withCredentials:p,body:a,success:function(n){k.log("Destroyed handle:"),k.debug(n),"success"!==n.janus&&k.error("Ooops: "+n.error.code+" "+n.error.reason),delete S[e],r.success()},error:function(n,t){k.error(n+":",t),delete S[e],r.success()}})}function V(e,n,t,r,i){var o=S[e];if(!o||!o.webrtcStuff)return k.warn("Invalid handle"),r.stream||k.stopAllTracks(i),void r.error("Invalid handle");var a=o.webrtcStuff;k.debug("streamsDone:",i),i&&(k.debug("  -- Audio tracks:",i.getAudioTracks()),k.debug("  -- Video tracks:",i.getVideoTracks()));var s=!1;if(a.myStream&&t.update&&!a.streamExternal){if((!t.update&&q(t)||t.update&&(t.addAudio||t.replaceAudio))&&i.getAudioTracks()&&i.getAudioTracks().length)if(a.myStream.addTrack(i.getAudioTracks()[0]),k.unifiedPlan){k.log((t.replaceAudio?"Replacing":"Adding")+" audio track:",i.getAudioTracks()[0]);var p=null;if((v=a.pc.getTransceivers())&&v.length>0)for(var f of v)if(f.sender&&f.sender.track&&"audio"===f.sender.track.kind||f.receiver&&f.receiver.track&&"audio"===f.receiver.track.kind){p=f;break}p&&p.sender?p.sender.replaceTrack(i.getAudioTracks()[0]):a.pc.addTrack(i.getAudioTracks()[0],i)}else k.log((t.replaceAudio?"Replacing":"Adding")+" audio track:",i.getAudioTracks()[0]),a.pc.addTrack(i.getAudioTracks()[0],i);if((!t.update&&H(t)||t.update&&(t.addVideo||t.replaceVideo))&&i.getVideoTracks()&&i.getVideoTracks().length)if(a.myStream.addTrack(i.getVideoTracks()[0]),k.unifiedPlan){k.log((t.replaceVideo?"Replacing":"Adding")+" video track:",i.getVideoTracks()[0]);var v,m=null;if((v=a.pc.getTransceivers())&&v.length>0)for(var f of v)if(f.sender&&f.sender.track&&"video"===f.sender.track.kind||f.receiver&&f.receiver.track&&"video"===f.receiver.track.kind){m=f;break}m&&m.sender?m.sender.replaceTrack(i.getVideoTracks()[0]):a.pc.addTrack(i.getVideoTracks()[0],i)}else k.log((t.replaceVideo?"Replacing":"Adding")+" video track:",i.getVideoTracks()[0]),a.pc.addTrack(i.getVideoTracks()[0],i)}else a.myStream=i,s=!0;if(!a.pc){var g={iceServers:c,iceTransportPolicy:d,bundlePolicy:l};"chrome"===k.webRTCAdapter.browserDetails.browser&&(g.sdpSemantics=k.webRTCAdapter.browserDetails.version<72?"plan-b":"unified-plan");var h={optional:[{DtlsSrtpKeyAgreement:!0}]};if(u&&h.optional.push({googIPv6:!0}),r.rtcConstraints&&"object"==typeof r.rtcConstraints)for(var b in k.debug("Adding custom PeerConnection constraints:",r.rtcConstraints),r.rtcConstraints)h.optional.push(r.rtcConstraints[b]);"edge"===k.webRTCAdapter.browserDetails.browser&&(g.bundlePolicy="max-bundle"),RTCRtpSender&&(RTCRtpSender.prototype.createEncodedStreams||RTCRtpSender.prototype.createEncodedAudioStreams&&RTCRtpSender.prototype.createEncodedVideoStreams)&&(r.senderTransforms||r.receiverTransforms)&&(a.senderTransforms=r.senderTransforms,a.receiverTransforms=r.receiverTransforms,g.forceEncodedAudioInsertableStreams=!0,g.forceEncodedVideoInsertableStreams=!0,g.encodedInsertableStreams=!0),k.log("Creating PeerConnection"),k.debug(h),a.pc=new RTCPeerConnection(g,h),k.debug(a.pc),a.pc.getStats&&(a.volume={},a.bitrate.value="0 kbits/sec"),k.log("Preparing local SDP and gathering candidates (trickle="+a.trickle+")"),a.pc.oniceconnectionstatechange=function(e){a.pc&&o.iceState(a.pc.iceConnectionState)},a.pc.onicecandidate=function(n){if(!n.candidate||"edge"===k.webRTCAdapter.browserDetails.browser&&n.candidate.candidate.indexOf("endOfCandidates")>0)k.log("End of candidates."),a.iceDone=!0,!0===a.trickle?I(e,{completed:!0}):function(e,n){(n=n||{}).success="function"==typeof n.success?n.success:k.noop,n.error="function"==typeof n.error?n.error:k.noop;var t=S[e];if(t&&t.webrtcStuff){var r=t.webrtcStuff;k.log("Sending offer/answer SDP..."),r.mySdp?(r.mySdp={type:r.pc.localDescription.type,sdp:r.pc.localDescription.sdp},!1===r.trickle&&(r.mySdp.trickle=!1),k.debug(n),r.sdpSent=!0,n.success(r.mySdp)):k.warn("Local SDP instance is invalid, not sending anything...")}else k.warn("Invalid handle, not sending anything")}(e,r);else{var t={candidate:n.candidate.candidate,sdpMid:n.candidate.sdpMid,sdpMLineIndex:n.candidate.sdpMLineIndex};!0===a.trickle&&I(e,t)}},a.pc.ontrack=function(e){if(k.log("Handling Remote Track"),k.debug(e),e.streams&&(a.remoteStream=e.streams[0],o.onremotestream(a.remoteStream),!e.track.onended)){if(a.receiverTransforms){var n=null;RTCRtpSender.prototype.createEncodedStreams?n=e.receiver.createEncodedStreams():(RTCRtpSender.prototype.createAudioEncodedStreams||RTCRtpSender.prototype.createEncodedVideoStreams)&&("audio"===e.track.kind&&a.receiverTransforms.audio?n=e.receiver.createEncodedAudioStreams():"video"===e.track.kind&&a.receiverTransforms.video&&(n=e.receiver.createEncodedVideoStreams())),n&&(n.readableStream&&n.writableStream?n.readableStream.pipeThrough(a.receiverTransforms[e.track.kind]).pipeTo(n.writableStream):n.readable&&n.writable&&n.readable.pipeThrough(a.receiverTransforms[e.track.kind]).pipeTo(n.writable))}var t=null;k.log("Adding onended callback to track:",e.track),e.track.onended=function(e){k.log("Remote track removed:",e),a.remoteStream&&(clearTimeout(t),a.remoteStream.removeTrack(e.target),o.onremotestream(a.remoteStream))},e.track.onmute=function(e){k.log("Remote track muted:",e),a.remoteStream&&null==t&&(t=setTimeout((function(){k.log("Removing remote track"),a.remoteStream&&(a.remoteStream.removeTrack(e.target),o.onremotestream(a.remoteStream)),t=null}),2520))},e.track.onunmute=function(e){if(k.log("Remote track flowing again:",e),null!=t)clearTimeout(t),t=null;else try{let n=a.pc?a.pc.getTransceivers():null,t=n?n.find((n=>n.receiver.track===e.target)):null,r=t?t.mid:e.target.id;o.onremotetrack(e.target,r,!0,{reason:"unmute"})}catch(e){k.error("Error calling onremotetrack on unmute",e)}}}}}if(s&&i){k.log("Adding local stream");var y=!0===r.simulcast2;i.getTracks().forEach((function(e){k.log("Adding local track:",e);var n=null;if(y&&"audio"!==e.kind){k.log("Enabling rid-based simulcasting:",e);var t=w(r.simulcastMaxBitrates),o=a.pc.addTransceiver(e,{direction:"sendrecv",streams:[i],sendEncodings:r.sendEncodings||[{rid:"h",active:!0,maxBitrate:t.high},{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:t.low,scaleResolutionDownBy:4}]});o&&(n=o.sender)}else n=a.pc.addTrack(e,i);if(n&&a.senderTransforms){var s=null;RTCRtpSender.prototype.createEncodedStreams?s=n.createEncodedStreams():(RTCRtpSender.prototype.createAudioEncodedStreams||RTCRtpSender.prototype.createEncodedVideoStreams)&&("audio"===n.track.kind&&a.senderTransforms.audio?s=n.createEncodedAudioStreams():"video"===n.track.kind&&a.senderTransforms.video&&(s=n.createEncodedVideoStreams())),s&&(s.readableStream&&s.writableStream?s.readableStream.pipeThrough(a.senderTransforms[n.track.kind]).pipeTo(s.writableStream):s.readable&&s.writable&&s.readable.pipeThrough(a.senderTransforms[n.track.kind]).pipeTo(s.writable))}}))}(function(e){return k.debug("isDataEnabled:",e),"edge"===k.webRTCAdapter.browserDetails.browser?(k.warn("Edge doesn't support data channels yet"),!1):null!=e&&!0===e.data})(t)&&!a.dataChannel[k.dataChanDefaultLabel]&&(k.log("Creating default data channel"),_(e,k.dataChanDefaultLabel,null,!1),a.pc.ondatachannel=function(n){k.log("Data channel created by Janus:",n),_(e,n.channel.label,n.channel.protocol,n.channel)}),a.myStream&&o.onlocalstream(a.myStream),n?a.pc.setRemoteDescription(n).then((function(){if(k.log("Remote description accepted!"),a.remoteSdp=n.sdp,a.candidates&&a.candidates.length>0){for(var i=0;i<a.candidates.length;i++){var o=a.candidates[i];k.debug("Adding remote candidate:",o),o&&!0!==o.completed?a.pc.addIceCandidate(o):a.pc.addIceCandidate(k.endOfCandidates)}a.candidates=[]}!function(e,n,t){(t=t||{}).success="function"==typeof t.success?t.success:k.noop,t.error="function"==typeof t.error?t.error:k.noop,t.customizeSdp="function"==typeof t.customizeSdp?t.customizeSdp:k.noop;var r=S[e];if(!r||!r.webrtcStuff)return k.warn("Invalid handle"),void t.error("Invalid handle");var i=r.webrtcStuff,o=!0===t.simulcast;o?k.log("Creating answer (iceDone="+i.iceDone+", simulcast="+o+")"):k.log("Creating answer (iceDone="+i.iceDone+")");var a=null;if(k.unifiedPlan){a={};var s=null,c=null,d=i.pc.getTransceivers();if(d&&d.length>0)for(var l of d)l.sender&&l.sender.track&&"audio"===l.sender.track.kind||l.receiver&&l.receiver.track&&"audio"===l.receiver.track.kind?s||(s=l):(l.sender&&l.sender.track&&"video"===l.sender.track.kind||l.receiver&&l.receiver.track&&"video"===l.receiver.track.kind)&&(c||(c=l));var u=q(n),p=W(n);if(u||p){if(u&&p){if(s)try{s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",k.log("Setting audio transceiver to sendrecv:",s)}catch(e){k.error(e)}}else if(u&&!p)try{s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",k.log("Setting audio transceiver to sendonly:",s))}catch(e){k.error(e)}else if(!u&&p)if(s)try{s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",k.log("Setting audio transceiver to recvonly:",s)}catch(e){k.error(e)}else s=i.pc.addTransceiver("audio",{direction:"recvonly"}),k.log("Adding recvonly audio transceiver:",s)}else if(n.removeAudio&&s)try{s.setDirection?s.setDirection("inactive"):s.direction="inactive",k.log("Setting audio transceiver to inactive:",s)}catch(e){k.error(e)}var f=H(n),v=$(n);if(f||v){if(f&&v){if(c)try{c.setDirection?c.setDirection("sendrecv"):c.direction="sendrecv",k.log("Setting video transceiver to sendrecv:",c)}catch(e){k.error(e)}}else if(f&&!v){if(c)try{c.setDirection?c.setDirection("sendonly"):c.direction="sendonly",k.log("Setting video transceiver to sendonly:",c)}catch(e){k.error(e)}}else if(!f&&v)if(c)try{c.setDirection?c.setDirection("recvonly"):c.direction="recvonly",k.log("Setting video transceiver to recvonly:",c)}catch(e){k.error(e)}else c=i.pc.addTransceiver("video",{direction:"recvonly"}),k.log("Adding recvonly video transceiver:",c)}else if(n.removeVideo&&c)try{c.setDirection?c.setDirection("inactive"):c.direction="inactive",k.log("Setting video transceiver to inactive:",c)}catch(e){k.error(e)}}else a="firefox"===k.webRTCAdapter.browserDetails.browser||"edge"===k.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:W(n),offerToReceiveVideo:$(n)}:{mandatory:{OfferToReceiveAudio:W(n),OfferToReceiveVideo:$(n)}};k.debug(a);var m=H(n);if(m&&o&&"firefox"===k.webRTCAdapter.browserDetails.browser){k.log("Enabling Simulcasting for Firefox (RID)");var g=i.pc.getSenders()[1];k.log(g);var h=g.getParameters();k.log(h);var b=w(t.simulcastMaxBitrates);g.setParameters({encodings:t.sendEncodings||[{rid:"h",active:!0,maxBitrate:b.high},{rid:"m",active:!0,maxBitrate:b.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:b.low,scaleResolutionDownBy:4}]})}i.pc.createAnswer(a).then((function(e){k.debug(e);var n={type:e.type,sdp:e.sdp};t.customizeSdp(n),e.sdp=n.sdp,k.log("Setting local description"),m&&o&&("chrome"===k.webRTCAdapter.browserDetails.browser?k.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"):"firefox"!==k.webRTCAdapter.browserDetails.browser&&k.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),i.mySdp=e.sdp,i.pc.setLocalDescription(e).catch(t.error),i.mediaConstraints=a,i.iceDone||i.trickle?((i.senderTransforms||i.receiverTransforms)&&(e.e2ee=!0),t.success(e)):k.log("Waiting for all candidates...")}),t.error)}(e,t,r)}),r.error):function(e,n,t){(t=t||{}).success="function"==typeof t.success?t.success:k.noop,t.error="function"==typeof t.error?t.error:k.noop,t.customizeSdp="function"==typeof t.customizeSdp?t.customizeSdp:k.noop;var r=S[e];if(!r||!r.webrtcStuff)return k.warn("Invalid handle"),void t.error("Invalid handle");var i=r.webrtcStuff,o=!0===t.simulcast;o?k.log("Creating offer (iceDone="+i.iceDone+", simulcast="+o+")"):k.log("Creating offer (iceDone="+i.iceDone+")");var a={};if(k.unifiedPlan){var s=null,c=null,d=i.pc.getTransceivers();if(d&&d.length>0)for(var l of d)l.sender&&l.sender.track&&"audio"===l.sender.track.kind||l.receiver&&l.receiver.track&&"audio"===l.receiver.track.kind?s||(s=l):(l.sender&&l.sender.track&&"video"===l.sender.track.kind||l.receiver&&l.receiver.track&&"video"===l.receiver.track.kind)&&(c||(c=l));var u=q(n),p=W(n);u||p?u&&p?s&&(s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",k.log("Setting audio transceiver to sendrecv:",s)):u&&!p?s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",k.log("Setting audio transceiver to sendonly:",s)):!u&&p&&(s?(s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",k.log("Setting audio transceiver to recvonly:",s)):(s=i.pc.addTransceiver("audio",{direction:"recvonly"}),k.log("Adding recvonly audio transceiver:",s))):n.removeAudio&&s&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive",k.log("Setting audio transceiver to inactive:",s));var f=H(n),v=$(n);f||v?f&&v?c&&(c.setDirection?c.setDirection("sendrecv"):c.direction="sendrecv",k.log("Setting video transceiver to sendrecv:",c)):f&&!v?c&&(c.setDirection?c.setDirection("sendonly"):c.direction="sendonly",k.log("Setting video transceiver to sendonly:",c)):!f&&v&&(c?(c.setDirection?c.setDirection("recvonly"):c.direction="recvonly",k.log("Setting video transceiver to recvonly:",c)):(c=i.pc.addTransceiver("video",{direction:"recvonly"}),k.log("Adding recvonly video transceiver:",c))):n.removeVideo&&c&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive",k.log("Setting video transceiver to inactive:",c))}else a.offerToReceiveAudio=W(n),a.offerToReceiveVideo=$(n);!0===t.iceRestart&&(a.iceRestart=!0),k.debug(a);var m=H(n);if(m&&o&&"firefox"===k.webRTCAdapter.browserDetails.browser){k.log("Enabling Simulcasting for Firefox (RID)");var g=i.pc.getSenders().find((function(e){return"video"===e.track.kind}));if(g){var h=g.getParameters();h||(h={});var b=w(t.simulcastMaxBitrates);h.encodings=t.sendEncodings||[{rid:"h",active:!0,maxBitrate:b.high},{rid:"m",active:!0,maxBitrate:b.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:b.low,scaleResolutionDownBy:4}],g.setParameters(h)}}i.pc.createOffer(a).then((function(e){k.debug(e);var n={type:e.type,sdp:e.sdp};t.customizeSdp(n),e.sdp=n.sdp,k.log("Setting local description"),m&&o&&("chrome"===k.webRTCAdapter.browserDetails.browser||"safari"===k.webRTCAdapter.browserDetails.browser?(k.log("Enabling Simulcasting for Chrome (SDP munging)"),e.sdp=function(e){for(var n=e.split("\r\n"),t=!1,r=[-1],i=[-1],o=null,a=null,s=null,c=null,d=-1,l=0;l<n.length;l++)if(p=n[l].match(/m=(\w+) */)){if("video"===p[1]){if(!(r[0]<0)){d=l;break}t=!0}else if(r[0]>-1){d=l;break}}else if(t){var u=n[l].match(/a=ssrc-group:FID (\d+) (\d+)/);if(u)r[0]=u[1],i[0]=u[2],n.splice(l,1),l--;else{if(r[0]){if((v=n[l].match("a=ssrc:"+r[0]+" cname:(.+)"))&&(o=v[1]),(v=n[l].match("a=ssrc:"+r[0]+" msid:(.+)"))&&(a=v[1]),(v=n[l].match("a=ssrc:"+r[0]+" mslabel:(.+)"))&&(s=v[1]),(v=n[l].match("a=ssrc:"+r[0]+" label:(.+)"))&&(c=v[1]),0===n[l].indexOf("a=ssrc:"+i[0])){n.splice(l,1),l--;continue}if(0===n[l].indexOf("a=ssrc:"+r[0])){n.splice(l,1),l--;continue}}0!=n[l].length||(n.splice(l,1),l--)}}if(r[0]<0)for(d=-1,t=!1,l=0;l<n.length;l++){var p;if(p=n[l].match(/m=(\w+) */)){if("video"===p[1]){if(!(r[0]<0)){d=l;break}t=!0}else if(r[0]>-1){d=l;break}}else if(t){if(r[0]<0){var f=n[l].match(/a=ssrc:(\d+)/);if(f){r[0]=f[1],n.splice(l,1),l--;continue}}else{var v;if((v=n[l].match("a=ssrc:"+r[0]+" cname:(.+)"))&&(o=v[1]),(v=n[l].match("a=ssrc:"+r[0]+" msid:(.+)"))&&(a=v[1]),(v=n[l].match("a=ssrc:"+r[0]+" mslabel:(.+)"))&&(s=v[1]),(v=n[l].match("a=ssrc:"+r[0]+" label:(.+)"))&&(c=v[1]),0===n[l].indexOf("a=ssrc:"+i[0])){n.splice(l,1),l--;continue}if(0===n[l].indexOf("a=ssrc:"+r[0])){n.splice(l,1),l--;continue}}0!==n[l].length||(n.splice(l,1),l--)}}if(r[0]<0)return k.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),e;for(d<0&&(d=n.length),r[1]=Math.floor(4294967295*Math.random()),r[2]=Math.floor(4294967295*Math.random()),i[1]=Math.floor(4294967295*Math.random()),i[2]=Math.floor(4294967295*Math.random()),l=0;l<r.length;l++)o&&(n.splice(d,0,"a=ssrc:"+r[l]+" cname:"+o),d++),a&&(n.splice(d,0,"a=ssrc:"+r[l]+" msid:"+a),d++),s&&(n.splice(d,0,"a=ssrc:"+r[l]+" mslabel:"+s),d++),c&&(n.splice(d,0,"a=ssrc:"+r[l]+" label:"+c),d++),o&&(n.splice(d,0,"a=ssrc:"+i[l]+" cname:"+o),d++),a&&(n.splice(d,0,"a=ssrc:"+i[l]+" msid:"+a),d++),s&&(n.splice(d,0,"a=ssrc:"+i[l]+" mslabel:"+s),d++),c&&(n.splice(d,0,"a=ssrc:"+i[l]+" label:"+c),d++);return n.splice(d,0,"a=ssrc-group:FID "+r[2]+" "+i[2]),n.splice(d,0,"a=ssrc-group:FID "+r[1]+" "+i[1]),n.splice(d,0,"a=ssrc-group:FID "+r[0]+" "+i[0]),n.splice(d,0,"a=ssrc-group:SIM "+r[0]+" "+r[1]+" "+r[2]),(e=n.join("\r\n")).endsWith("\r\n")||(e+="\r\n"),e}(e.sdp)):"firefox"!==k.webRTCAdapter.browserDetails.browser&&k.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),i.mySdp=e.sdp,i.pc.setLocalDescription(e).catch(t.error),i.mediaConstraints=a,i.iceDone||i.trickle?((i.senderTransforms||i.receiverTransforms)&&(e.e2ee=!0),t.success(e)):k.log("Waiting for all candidates...")}),t.error)}(e,t,r)}function L(e,n,t){(t=t||{}).success="function"==typeof t.success?t.success:k.noop,t.error="function"==typeof t.error?t.error:z;var r=t.jsep;if(n&&r)return k.error("Provided a JSEP to a createOffer"),void t.error("Provided a JSEP to a createOffer");if(!(n||r&&r.type&&r.sdp))return k.error("A valid JSEP is required for createAnswer"),void t.error("A valid JSEP is required for createAnswer");t.media="object"==typeof t.media&&t.media?t.media:{audio:!0,video:!0};var i=t.media,o=S[e];if(!o||!o.webrtcStuff)return k.warn("Invalid handle"),void t.error("Invalid handle");var a,s=o.webrtcStuff;if(s.trickle=(a=t.trickle,k.debug("isTrickleEnabled:",a),!1!==a),s.pc){if(k.log("Updating existing media session"),i.update=!0,t.stream)t.stream!==s.myStream&&k.log("Renegotiation involves a new external stream");else{if(i.addAudio){if(i.keepAudio=!1,i.replaceAudio=!1,i.removeAudio=!1,i.audioSend=!0,s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length)return k.error("Can't add audio stream, there already is one"),void t.error("Can't add audio stream, there already is one")}else i.removeAudio?(i.keepAudio=!1,i.replaceAudio=!1,i.addAudio=!1,i.audioSend=!1):i.replaceAudio&&(i.keepAudio=!1,i.addAudio=!1,i.removeAudio=!1,i.audioSend=!0);if(s.myStream&&s.myStream.getAudioTracks()&&0!==s.myStream.getAudioTracks().length?!q(i)||i.removeAudio||i.replaceAudio||(i.keepAudio=!0):(i.replaceAudio&&(i.keepAudio=!1,i.replaceAudio=!1,i.addAudio=!0,i.audioSend=!0),q(i)&&(i.keepAudio=!1,i.addAudio=!0)),i.addVideo){if(i.keepVideo=!1,i.replaceVideo=!1,i.removeVideo=!1,i.videoSend=!0,s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length)return k.error("Can't add video stream, there already is one"),void t.error("Can't add video stream, there already is one")}else i.removeVideo?(i.keepVideo=!1,i.replaceVideo=!1,i.addVideo=!1,i.videoSend=!1):i.replaceVideo&&(i.keepVideo=!1,i.addVideo=!1,i.removeVideo=!1,i.videoSend=!0);s.myStream&&s.myStream.getVideoTracks()&&0!==s.myStream.getVideoTracks().length?!H(i)||i.removeVideo||i.replaceVideo||(i.keepVideo=!0):(i.replaceVideo&&(i.keepVideo=!1,i.replaceVideo=!1,i.addVideo=!0,i.videoSend=!0),H(i)&&(i.keepVideo=!1,i.addVideo=!0)),i.addData&&(i.data=!0)}if(q(i)&&i.keepAudio&&H(i)&&i.keepVideo)return o.consentDialog(!1),void V(e,r,i,t,s.myStream)}else i.update=!1,i.keepAudio=!1,i.keepVideo=!1;if(i.update&&!s.streamExternal){if(i.removeAudio||i.replaceAudio){if(s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length){var c=s.myStream.getAudioTracks()[0];k.log("Removing audio track:",c),s.myStream.removeTrack(c);try{c.stop()}catch(D){}}if(s.pc.getSenders()&&s.pc.getSenders().length){var d=!0;if(i.replaceAudio&&k.unifiedPlan&&(d=!1),d)for(var l of s.pc.getSenders())l&&l.track&&"audio"===l.track.kind&&(k.log("Removing audio sender:",l),s.pc.removeTrack(l))}}if(i.removeVideo||i.replaceVideo){if(s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length){var u=s.myStream.getVideoTracks()[0];k.log("Removing video track:",u),s.myStream.removeTrack(u);try{u.stop()}catch(P){}}if(s.pc.getSenders()&&s.pc.getSenders().length){var p=!0;if(i.replaceVideo&&k.unifiedPlan&&(p=!1),p)for(var f of s.pc.getSenders())f&&f.track&&"video"===f.track.kind&&(k.log("Removing video sender:",f),s.pc.removeTrack(f))}}}if(t.stream){var v=t.stream;return k.log("MediaStream provided by the application"),k.debug(v),i.update&&s.myStream&&s.myStream!==t.stream&&!s.streamExternal&&(k.stopAllTracks(s.myStream),s.myStream=null),s.streamExternal=!0,o.consentDialog(!1),void V(e,r,i,t,v)}if(q(i)||H(i)){if(!k.isGetUserMediaAvailable())return void t.error("getUserMedia not available");var m={mandatory:{},optional:[]};o.consentDialog(!0);var g=q(i);g&&i&&"object"==typeof i.audio&&(g=i.audio);var h=H(i);if(h&&i){var w=!0===t.simulcast,b=!0===t.simulcast2;if(!w&&!b||r||i.video||(i.video="hires"),i.video&&"screen"!=i.video&&"window"!=i.video)if("object"==typeof i.video)h=i.video;else{var y=0,C=0;"lowres"===i.video?(C=240,y=320):"lowres-16:9"===i.video?(C=180,y=320):"hires"===i.video||"hires-16:9"===i.video||"hdres"===i.video?(C=720,y=1280):"fhdres"===i.video?(C=1080,y=1920):"4kres"===i.video?(C=2160,y=3840):"stdres"===i.video?(C=480,y=640):"stdres-16:9"===i.video?(C=360,y=640):(k.log("Default video setting is stdres 4:3"),C=480,y=640),k.log("Adding media constraint:",i.video),h={height:{ideal:C},width:{ideal:y}},k.log("Adding video constraint:",h)}else if("screen"===i.video||"window"===i.video){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return m.video={},i.screenshareFrameRate&&(m.video.frameRate=i.screenshareFrameRate),i.screenshareHeight&&(m.video.height=i.screenshareHeight),i.screenshareWidth&&(m.video.width=i.screenshareWidth),m.audio=i.captureDesktopAudio,void navigator.mediaDevices.getDisplayMedia(m).then((function(n){o.consentDialog(!1),q(i)&&!i.keepAudio?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(o){n.addTrack(o.getAudioTracks()[0]),V(e,r,i,t,n)})):V(e,r,i,t,n)}),(function(e){o.consentDialog(!1),t.error(e)}));function E(n,a){o.consentDialog(!1),n?t.error(n):V(e,r,i,t,a)}function A(e,n,t){k.log("Adding media constraint (screen capture)"),k.debug(e),navigator.mediaDevices.getUserMedia(e).then((function(e){t?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(t){e.addTrack(t.getAudioTracks()[0]),n(null,e)})):n(null,e)})).catch((function(e){o.consentDialog(!1),n(e)}))}if("chrome"===k.webRTCAdapter.browserDetails.browser){var T=k.webRTCAdapter.browserDetails.version,x=33;window.navigator.userAgent.match("Linux")&&(x=35),T>=26&&T<=x?A(m={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:i.screenshareFrameRate,maxFrameRate:i.screenshareFrameRate,chromeMediaSource:"screen"}},audio:q(i)&&!i.keepAudio},E):k.extension.getScreen((function(e,n){if(e)return o.consentDialog(!1),t.error(e);(m={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:i.screenshareFrameRate,maxFrameRate:i.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}}).video.mandatory.chromeMediaSourceId=n,A(m,E,q(i)&&!i.keepAudio)}))}else if("firefox"===k.webRTCAdapter.browserDetails.browser){if(!(k.webRTCAdapter.browserDetails.version>=33)){var R=new Error("NavigatorUserMediaError");return R.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",o.consentDialog(!1),void t.error(R)}A(m={video:{mozMediaSource:i.video,mediaSource:i.video},audio:q(i)&&!i.keepAudio},(function(e,n){if(E(e,n),!e)var t=n.currentTime,r=window.setInterval((function(){n||window.clearInterval(r),n.currentTime==t&&(window.clearInterval(r),n.onended&&n.onended()),t=n.currentTime}),500)}))}return}}i&&"screen"===i.video||navigator.mediaDevices.enumerateDevices().then((function(n){var a=n.some((function(e){return"audioinput"===e.kind})),s=function(e){if(k.debug("isScreenSendEnabled:",e),!e)return!1;if("object"!=typeof e.video||"object"!=typeof e.video.mandatory)return!1;var n=e.video.mandatory;return n.chromeMediaSource?"desktop"===n.chromeMediaSource||"screen"===n.chromeMediaSource:n.mozMediaSource?"window"===n.mozMediaSource||"screen"===n.mozMediaSource:!!n.mediaSource&&("window"===n.mediaSource||"screen"===n.mediaSource)}(i)||n.some((function(e){return"videoinput"===e.kind})),c=q(i),d=H(i),l=function(e){return k.debug("isAudioSendRequired:",e),!!e&&!1!==e.audio&&!1!==e.audioSend&&void 0!==e.failIfNoAudio&&null!==e.failIfNoAudio&&!0===e.failIfNoAudio}(i),u=function(e){return k.debug("isVideoSendRequired:",e),!!e&&!1!==e.video&&!1!==e.videoSend&&void 0!==e.failIfNoVideo&&null!==e.failIfNoVideo&&!0===e.failIfNoVideo}(i);if(c||d||l||u){var p=!!c&&a,f=!!d&&s;if(!p&&!f)return o.consentDialog(!1),t.error("No capture device found"),!1;if(!p&&l)return o.consentDialog(!1),t.error("Audio capture is required, but no capture device found"),!1;if(!f&&u)return o.consentDialog(!1),t.error("Video capture is required, but no capture device found"),!1}var m={audio:!(!a||i.keepAudio)&&g,video:!(!s||i.keepVideo)&&h};k.debug("getUserMedia constraints",m),m.audio||m.video?navigator.mediaDevices.getUserMedia(m).then((function(n){o.consentDialog(!1),V(e,r,i,t,n)})).catch((function(e){o.consentDialog(!1),t.error({code:e.code,name:e.name,message:e.message})})):(o.consentDialog(!1),V(e,r,i,t,v))})).catch((function(e){o.consentDialog(!1),t.error(e)}))}else console.log("Else de audio o video deshabilitado"),V(e,r,i,t)}function N(e,n){(n=n||{}).success="function"==typeof n.success?n.success:k.noop,n.error="function"==typeof n.error?n.error:z;var t=n.jsep,r=S[e];if(!r||!r.webrtcStuff)return k.warn("Invalid handle"),void n.error("Invalid handle");var i=r.webrtcStuff;if(t){if(!i.pc)return k.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void n.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");i.pc.setRemoteDescription(t).then((function(){if(k.log("Remote description accepted!"),i.remoteSdp=t.sdp,i.candidates&&i.candidates.length>0){for(var e=0;e<i.candidates.length;e++){var r=i.candidates[e];k.debug("Adding remote candidate:",r),r&&!0!==r.completed?i.pc.addIceCandidate(r):i.pc.addIceCandidate(k.endOfCandidates)}i.candidates=[]}n.success()}),n.error)}else n.error("Invalid JSEP")}function U(e,n){var t=S[e];if(!t||!t.webrtcStuff)return k.warn("Invalid handle"),0;var r=n?"remote":"local",i=t.webrtcStuff;return i.volume[r]||(i.volume[r]={value:0}),!i.pc.getStats||"chrome"!==k.webRTCAdapter.browserDetails.browser&&"safari"!==k.webRTCAdapter.browserDetails.browser?(k.warn("Getting the "+r+" volume unsupported by browser"),0):n&&!i.remoteStream?(k.warn("Remote stream unavailable"),0):n||i.myStream?i.volume[r].timer?i.volume[r].value:(k.log("Starting "+r+" volume monitor"),i.volume[r].timer=setInterval((function(){i.pc.getStats().then((function(e){e.forEach((function(e){e&&"audio"===e.kind&&(n&&!e.remoteSource||!n&&"media-source"!==e.type||(i.volume[r].value=e.audioLevel?e.audioLevel:0))}))}))}),200),0):(k.warn("Local stream unavailable"),0)}function B(e,n){var t=S[e];if(!t||!t.webrtcStuff)return k.warn("Invalid handle"),!0;var r=t.webrtcStuff;return r.pc?r.myStream?n?r.myStream.getVideoTracks()&&0!==r.myStream.getVideoTracks().length?!r.myStream.getVideoTracks()[0].enabled:(k.warn("No video track"),!0):r.myStream.getAudioTracks()&&0!==r.myStream.getAudioTracks().length?!r.myStream.getAudioTracks()[0].enabled:(k.warn("No audio track"),!0):(k.warn("Invalid local MediaStream"),!0):(k.warn("Invalid PeerConnection"),!0)}function F(e,n,t){var r=S[e];if(!r||!r.webrtcStuff)return k.warn("Invalid handle"),!1;var i=r.webrtcStuff;return i.pc?i.myStream?n?i.myStream.getVideoTracks()&&0!==i.myStream.getVideoTracks().length?(i.myStream.getVideoTracks()[0].enabled=!t,!0):(k.warn("No video track"),!1):i.myStream.getAudioTracks()&&0!==i.myStream.getAudioTracks().length?(i.myStream.getAudioTracks()[0].enabled=!t,!0):(k.warn("No audio track"),!1):(k.warn("Invalid local MediaStream"),!1):(k.warn("Invalid PeerConnection"),!1)}function G(e){var n=S[e];if(!n||!n.webrtcStuff)return k.warn("Invalid handle"),"Invalid handle";var t=n.webrtcStuff;return t.pc?t.pc.getStats?t.bitrate.timer?t.bitrate.value:(k.log("Starting bitrate timer (via getStats)"),t.bitrate.timer=setInterval((function(){t.pc.getStats().then((function(e){e.forEach((function(e){if(e){var n=!1;if(("video"===e.mediaType||e.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===e.type&&e.id.indexOf("rtcp")<0?n=!0:"ssrc"!=e.type||!e.bytesReceived||"VP8"!==e.googCodecName&&""!==e.googCodecName||(n=!0),n)if(t.bitrate.bsnow=e.bytesReceived,t.bitrate.tsnow=e.timestamp,null===t.bitrate.bsbefore||null===t.bitrate.tsbefore)t.bitrate.bsbefore=t.bitrate.bsnow,t.bitrate.tsbefore=t.bitrate.tsnow;else{var r=t.bitrate.tsnow-t.bitrate.tsbefore;"safari"===k.webRTCAdapter.browserDetails.browser&&(r/=1e3);var i=Math.round(8*(t.bitrate.bsnow-t.bitrate.bsbefore)/r);"safari"===k.webRTCAdapter.browserDetails.browser&&(i=parseInt(i/1e3)),t.bitrate.value=i+" kbits/sec",t.bitrate.bsbefore=t.bitrate.bsnow,t.bitrate.tsbefore=t.bitrate.tsnow}}}))}))}),1e3),"0 kbits/sec"):(k.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser"):"Invalid PeerConnection"}function z(e){k.error("WebRTC error:",e)}function J(e,r){k.log("Cleaning WebRTC stuff");var i=S[e];if(i){var o=i.webrtcStuff;if(o){if(!0===r){var a={janus:"hangup",transaction:k.randomString(12)};i.token&&(a.token=i.token),m&&(a.apisecret=m),k.debug("Sending hangup request (handle="+e+"):"),k.debug(a),n?(a.session_id=y,a.handle_id=e,t.send(JSON.stringify(a))):k.httpAPICall(s+"/"+y+"/"+e,{verb:"POST",withCredentials:p,body:a})}o.remoteStream=null,o.volume&&(o.volume.local&&o.volume.local.timer&&clearInterval(o.volume.local.timer),o.volume.remote&&o.volume.remote.timer&&clearInterval(o.volume.remote.timer)),o.volume={},o.bitrate.timer&&clearInterval(o.bitrate.timer),o.bitrate.timer=null,o.bitrate.bsnow=null,o.bitrate.bsbefore=null,o.bitrate.tsnow=null,o.bitrate.tsbefore=null,o.bitrate.value=null,!o.streamExternal&&o.myStream&&(k.log("Stopping local stream tracks"),k.stopAllTracks(o.myStream)),o.streamExternal=!1,o.myStream=null;try{o.pc.close()}catch(e){}o.pc=null,o.candidates=null,o.mySdp=null,o.remoteSdp=null,o.iceDone=!1,o.dataChannel={},o.dtmfSender=null,o.senderTransforms=null,o.receiverTransforms=null}i.oncleanup()}}function q(e){return k.debug("isAudioSendEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function W(e){return k.debug("isAudioRecvEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function H(e){return k.debug("isVideoSendEnabled:",e),!e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function $(e){return k.debug("isVideoRecvEnabled:",e),!e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}E(e),this.getServer=function(){return s},this.isConnected=function(){return b},this.reconnect=function(e){(e=e||{}).success="function"==typeof e.success?e.success:k.noop,e.error="function"==typeof e.error?e.error:k.noop,e.reconnect=!0,E(e)},this.getSessionId=function(){return y},this.getInfo=function(e){!function(e){if((e=e||{}).success="function"==typeof e.success?e.success:k.noop,e.error="function"==typeof e.error?e.error:k.noop,k.log("Getting info on Janus instance"),!b)return k.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var r=k.randomString(12),i={janus:"info",transaction:r};if(v&&(i.token=v),m&&(i.apisecret=m),n)return x[r]=function(n){k.log("Server info:"),k.debug(n),"server_info"!==n.janus&&k.error("Ooops: "+n.error.code+" "+n.error.reason),e.success(n)},void t.send(JSON.stringify(i));k.httpAPICall(s,{verb:"POST",withCredentials:p,body:i,success:function(n){k.log("Server info:"),k.debug(n),"server_info"!==n.janus&&k.error("Ooops: "+n.error.code+" "+n.error.reason),e.success(n)},error:function(n,t){k.error(n+":",t),""===t?e.error(n+": Is the server down?"):e.error(n+": "+t)}})}(e)},this.destroy=function(o){!function(o){(o=o||{}).success="function"==typeof o.success?o.success:k.noop,o.error="function"==typeof o.error?o.error:k.noop;var a=!0===o.unload,c=!0;void 0!==o.notifyDestroyed&&null!==o.notifyDestroyed&&(c=!0===o.notifyDestroyed);var d=!0===o.cleanupHandles;if(k.log("Destroying session "+y+" (unload="+a+")"),!y)return k.warn("No session to destroy"),o.success(),void(c&&e.destroyed());if(d)for(var l in S)j(l,{noRequest:!0});if(!b)return k.warn("Is the server down? (connected=false)"),y=null,void o.success();var u={janus:"destroy",transaction:k.randomString(12)};if(v&&(u.token=v),m&&(u.apisecret=m),a)return n?(t.onclose=null,t.close(),t=null):navigator.sendBeacon(s+"/"+y,JSON.stringify(u)),k.log("Destroyed session:"),y=null,b=!1,o.success(),void(c&&e.destroyed());if(n){u.session_id=y;var f=function(){for(var e in r)t.removeEventListener(e,r[e]);t.removeEventListener("message",g),t.removeEventListener("error",h),i&&clearTimeout(i),t.close()},g=function(n){var t=JSON.parse(n.data);t.session_id==u.session_id&&t.transaction==u.transaction&&(f(),o.success(),c&&e.destroyed())},h=function(n){f(),o.error("Failed to destroy the server: Is the server down?"),c&&e.destroyed()};return t.addEventListener("message",g),t.addEventListener("error",h),void(1===t.readyState?t.send(JSON.stringify(u)):h())}k.httpAPICall(s+"/"+y,{verb:"POST",withCredentials:p,body:u,success:function(n){k.log("Destroyed session:"),k.debug(n),y=null,b=!1,"success"!==n.janus&&k.error("Ooops: "+n.error.code+" "+n.error.reason),o.success(),c&&e.destroyed()},error:function(n,t){k.error(n+":",t),y=null,b=!1,o.success(),c&&e.destroyed()}})}(o)},this.attach=function(e){!function(e){if((e=e||{}).success="function"==typeof e.success?e.success:k.noop,e.error="function"==typeof e.error?e.error:k.noop,e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:k.noop,e.iceState="function"==typeof e.iceState?e.iceState:k.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:k.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:k.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:k.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:k.noop,e.onlocalstream="function"==typeof e.onlocalstream?e.onlocalstream:k.noop,e.onremotestream="function"==typeof e.onremotestream?e.onremotestream:k.noop,e.ondata="function"==typeof e.ondata?e.ondata:k.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:k.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:k.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:k.noop,!b)return k.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var r=e.plugin;if(!r)return k.error("Invalid plugin"),void e.error("Invalid plugin");var i=e.opaqueId,o=e.token?e.token:v,a=k.randomString(12),c={janus:"attach",plugin:r,opaque_id:i,transaction:a};if(o&&(c.token=o),m&&(c.apisecret=m),n)return x[a]=function(n){if(k.debug(n),"success"!==n.janus)return k.error("Ooops: "+n.error.code+" "+n.error.reason),void e.error("Ooops: "+n.error.code+" "+n.error.reason);var t=n.data.id;k.log("Created handle: "+t);var i={session:C,plugin:r,id:t,token:o,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return t},getPlugin:function(){return r},getVolume:function(){return U(t,!0)},getRemoteVolume:function(){return U(t,!0)},getLocalVolume:function(){return U(t,!1)},isAudioMuted:function(){return B(t,!1)},muteAudio:function(){return F(t,!1,!0)},unmuteAudio:function(){return F(t,!1,!1)},isVideoMuted:function(){return B(t,!0)},muteVideo:function(){return F(t,!0,!0)},unmuteVideo:function(){return F(t,!0,!1)},getBitrate:function(){return G(t)},send:function(e){A(t,e)},data:function(e){M(t,e)},dtmf:function(e){O(t,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){L(t,!0,e)},createAnswer:function(e){L(t,!1,e)},handleRemoteJsep:function(e){N(t,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){J(t,!0===e)},detach:function(e){j(t,e)}};S[t]=i,e.success(i)},c.session_id=y,void t.send(JSON.stringify(c));k.httpAPICall(s+"/"+y,{verb:"POST",withCredentials:p,body:c,success:function(n){if(k.debug(n),"success"!==n.janus)return k.error("Ooops: "+n.error.code+" "+n.error.reason),void e.error("Ooops: "+n.error.code+" "+n.error.reason);var t=n.data.id;k.log("Created handle: "+t);var i={session:C,plugin:r,id:t,token:o,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return t},getPlugin:function(){return r},getVolume:function(){return U(t,!0)},getRemoteVolume:function(){return U(t,!0)},getLocalVolume:function(){return U(t,!1)},isAudioMuted:function(){return B(t,!1)},muteAudio:function(){return F(t,!1,!0)},unmuteAudio:function(){return F(t,!1,!1)},isVideoMuted:function(){return B(t,!0)},muteVideo:function(){return F(t,!0,!0)},unmuteVideo:function(){return F(t,!0,!1)},getBitrate:function(){return G(t)},send:function(e){A(t,e)},data:function(e){M(t,e)},dtmf:function(e){O(t,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){L(t,!0,e)},createAnswer:function(e){L(t,!1,e)},handleRemoteJsep:function(e){N(t,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){J(t,!0===e)},detach:function(e){j(t,e)}};S[t]=i,e.success(i)},error:function(n,t){k.error(n+":",t),""===t?e.error(n+": Is the server down?"):e.error(n+": "+t)}})}(e)}}k.useDefaultDependencies=function(e){var n=e&&e.fetch||fetch,t=e&&e.Promise||Promise,r=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,n){return new r(e,n)},extension:e&&e.extension||C,isArray:function(e){return Array.isArray(e)},webRTCAdapter:e&&e.adapter||S(),httpAPICall:function(e,r){var i={method:r.verb,headers:{Accept:"application/json, text/plain, */*"},cache:"no-cache"};"POST"===r.verb&&(i.headers["Content-Type"]="application/json"),void 0!==r.withCredentials&&(i.credentials=!0===r.withCredentials?"include":r.withCredentials?r.withCredentials:"omit"),r.body&&(i.body=JSON.stringify(r.body));var o=n(e,i).catch((function(e){return t.reject({message:"Probably a network error, is the server down?",error:e})}));if(r.timeout){var a=new t((function(e,n){var t=setTimeout((function(){return clearTimeout(t),n({message:"Request timed out",timeout:r.timeout})}),r.timeout)}));o=t.race([o,a])}return o.then((function(e){return e.ok?typeof r.success==typeof k.noop?e.json().then((function(e){r.success(e)})).catch((function(n){return t.reject({message:"Failed to parse response body",error:n,response:e})})):void 0:t.reject({message:"API call failed",response:e})})).catch((function(e){typeof r.error==typeof k.noop&&r.error(e.message||"<< internal error >>",e)})),o}}},k.useOldDependencies=function(e){var n=e&&e.jQuery||jQuery,t=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,n){return new t(e,n)},isArray:function(e){return n.isArray(e)},extension:e&&e.extension||C,webRTCAdapter:e&&e.adapter||S(),httpAPICall:function(e,t){var r=void 0!==t.body?{contentType:"application/json",data:JSON.stringify(t.body)}:{},i=void 0!==t.withCredentials?{xhrFields:{withCredentials:t.withCredentials}}:{};return n.ajax(n.extend(r,i,{url:e,type:t.verb,cache:!1,dataType:"json",async:t.async,timeout:t.timeout,success:function(e){typeof t.success==typeof k.noop&&t.success(e)},error:function(e,n,r){typeof t.error==typeof k.noop&&t.error(n,r)}}))}}},k.noop=function(){},k.dataChanDefaultLabel="JanusDataChannel",k.endOfCandidates=null,k.stopAllTracks=function(e){try{var n=e.getTracks();for(var t of n)k.log(t),t&&t.stop()}catch(e){}},k.init=function(e){if((e=e||{}).callback="function"==typeof e.callback?e.callback:k.noop,k.initDone)e.callback();else{if("undefined"!=typeof console&&void 0!==console.log||(console={log:function(){}}),k.trace=k.noop,k.debug=k.noop,k.vdebug=k.noop,k.log=k.noop,k.warn=k.noop,k.error=k.noop,!0===e.debug||"all"===e.debug)k.trace=console.trace.bind(console),k.debug=console.debug.bind(console),k.vdebug=console.debug.bind(console),k.log=console.log.bind(console),k.warn=console.warn.bind(console),k.error=console.error.bind(console);else if(Array.isArray(e.debug))for(var n of e.debug)switch(n){case"trace":k.trace=console.trace.bind(console);break;case"debug":k.debug=console.debug.bind(console);break;case"vdebug":k.vdebug=console.debug.bind(console);break;case"log":k.log=console.log.bind(console);break;case"warn":k.warn=console.warn.bind(console);break;case"error":k.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+n+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')")}k.log("Initializing library");var t=e.dependencies||k.useDefaultDependencies();k.isArray=t.isArray,k.webRTCAdapter=t.webRTCAdapter,k.httpAPICall=t.httpAPICall,k.newWebSocket=t.newWebSocket,k.extension=t.extension,k.extension.init(),k.listDevices=function(e,n){e="function"==typeof e?e:k.noop,null==n&&(n={audio:!0,video:!0}),k.isGetUserMediaAvailable()?navigator.mediaDevices.getUserMedia(n).then((function(n){navigator.mediaDevices.enumerateDevices().then((function(t){k.debug(t),e(t),k.stopAllTracks(n)}))})).catch((function(n){k.error(n),e([])})):(k.warn("navigator.mediaDevices unavailable"),e([]))},k.attachMediaStream=function(e,n){try{e.srcObject=n}catch(t){try{e.src=URL.createObjectURL(n)}catch(e){k.error("Error attaching stream to element")}}},k.reattachMediaStream=function(e,n){try{e.srcObject=n.srcObject}catch(t){try{e.src=n.src}catch(e){k.error("Error reattaching stream to element")}}};var r=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0?"pagehide":"beforeunload",i=window["on"+r];if(window.addEventListener(r,(function(e){for(var n in k.log("Closing window"),k.sessions)k.sessions[n]&&k.sessions[n].destroyOnUnload&&(k.log("Destroying session "+n),k.sessions[n].destroy({unload:!0,notifyDestroyed:!1}));i&&"function"==typeof i&&i()})),k.safariVp8=!1,"safari"===k.webRTCAdapter.browserDetails.browser&&k.webRTCAdapter.browserDetails.version>=605)if(RTCRtpSender&&RTCRtpSender.getCapabilities&&RTCRtpSender.getCapabilities("video")&&RTCRtpSender.getCapabilities("video").codecs&&RTCRtpSender.getCapabilities("video").codecs.length){for(var o of RTCRtpSender.getCapabilities("video").codecs)if(o&&o.mimeType&&"video/vp8"===o.mimeType.toLowerCase()){k.safariVp8=!0;break}k.safariVp8?k.log("This version of Safari supports VP8"):k.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu")}else{var a=new RTCPeerConnection({});a.createOffer({offerToReceiveVideo:!0}).then((function(e){k.safariVp8=-1!==e.sdp.indexOf("VP8"),k.safariVp8?k.log("This version of Safari supports VP8"):k.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu"),a.close(),a=null}))}if(k.unifiedPlan=!1,"firefox"===k.webRTCAdapter.browserDetails.browser&&k.webRTCAdapter.browserDetails.version>=59)k.unifiedPlan=!0;else if("chrome"===k.webRTCAdapter.browserDetails.browser&&k.webRTCAdapter.browserDetails.version>=72)k.unifiedPlan=!0;else if(window.RTCRtpTransceiver&&"currentDirection"in RTCRtpTransceiver.prototype){var s=new RTCPeerConnection;try{s.addTransceiver("audio"),k.unifiedPlan=!0}catch(e){}s.close()}else k.unifiedPlan=!1;k.initDone=!0,e.callback()}},k.isWebrtcSupported=function(){return!!window.RTCPeerConnection},k.isGetUserMediaAvailable=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia},k.randomString=function(e){for(var n="",t=0;t<e;t++){var r=Math.floor(62*Math.random());n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".substring(r,r+1)}return n};var T=k;function x(e){for(var n="",t=0;t<e;t++)n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return n}function R(e){for(var n,t=e.length;0!==t;)n=Math.floor(Math.random()*t),t--,[e[t],e[n]]=[e[n],e[t]];return e}function D(e){this.message=e,this.name="NoCaptureDevice"}function P(e){this.message=e,this.name="UnexpectedAnswer"}function E(e){this.message=e,this.name="InvalidHandle"}function A(e){let n,t,r,i,o,a,s,c,d,l,u,p,f,v,m=!1,g=!1,h="default",w=null,b=!1,y="";var S=function(){u=setTimeout((()=>{C(),S()}),3e5)},C=function(){a=e.extension.domain,t&&t.send({message:{authuser:e.extension.number.toString(),display_name:e.extension.displayname,proxy:"sip:"+e.extension.domain,request:"register",username:"sip:"+e.extension.number+"@"+e.extension.domain,secret:e.extension.secret}})};function k(){n.destroy({notifyDestroyed:!0,cleanupHandles:!0,success:()=>{clearTimeout(u),clearTimeout(v)}})}return{startConnection:function(){return new Promise((function(o,a){T.init({debug:!1,callback:function(){n=new T({server:R(e.server),apisecret:e.api_secret,success:function(){return setTimeout((()=>{n.attach({plugin:"janus.plugin.sip",opaqueId:"console-"+T.randomString(12),success:function(e){t=e,C(),S()},error:function(e){d&&d(e)},onremotestream:async e=>{for(r&&T.attachMediaStream(r,e);!f;)await new Promise((e=>setTimeout(e,500)))},onlocalstream:async e=>{p=e,T.attachMediaStream(r,e)},onmessage:function(e,n){e.result&&("registered"===e.result.event&&(m=!0,v=setInterval((()=>{t.send({message:{request:"subscribe",event:"message-summary"},error:()=>{}})}),3e4)),"registered_fail"===e.result.event&&(m=!1),"progress"===e.result.event&&null!=n&&t.handleRemoteJsep({jsep:n,error:function(){console.log("Error")}}),"incomingcall"===e.result.event&&(b=!1,n&&(b=!0)),"incomingcall"===e.result.event&&(y=(new Date).getTime()+"@"+x(10)),"accepted"===e.result.event&&(null!=n&&t.handleRemoteJsep({jsep:n,error:function(e){console.log(e)}}),g=!0),"hangup"===e.result.event&&(g=!1,T.stopAllTracks(p)),"unregistered"===e.result.event&&(clearTimeout(u),C(),S())),i&&i(e,n)}})}),3e3),o()},error:function(e){return a(e)},destroyed:function(e){l&&l(e),e&&console.error(e)}})}})}))},onSipMessage:function(e){i=e},attachAudio:function(e){r=e},getCallTo:function(){return o},getCallToNumber:function(){return s},getIsInCall:()=>g,randomId:function(){return T.randomString(12)},isRegistered:function(){return m},call:function(e,n){return new Promise(((r,i)=>{o=n,s=e,y=(new Date).getTime()+"@"+x(10),(e=e.replace(/[-_+ ()]/g,"")).indexOf("@")<0&&(e+="@"+a),t.createOffer({media:{audioSend:!0,audioRecv:!0,videoSend:!1,videoRecv:!1},success:function(n){return t.send({message:{request:"call",uri:"sip:"+e,call_id:(new Date).getTime()+"@"+x(10)},jsep:n}),r(!0)},error:function(e){return c&&c(e),i(e)}})}))},hold:function(){t.send({message:{request:"hold"}})},mute:function(){t.muteAudio()},unhold:function(){t.send({message:{request:"unhold"}})},unmute:function(){t.unmuteAudio()},answer:function(e){return new Promise(((n,r)=>{(b?t.createAnswer:t.createOffer)({jsep:e,media:{audioSend:!0,audioRecv:!0,video:!1},success:function(e){setTimeout((()=>{t.send({message:{request:"accept"},jsep:e,error:function(e){return new RegExp("469 Unexpected ANSWER").test(e)?(k(),r(new P(e))):"Invalid handle"==e?(k(),r(new E(e))):r(e)},success:()=>n(!0)})}),500)},error:function(e){return"No capture device found"===e?r(new D("No capture device found")):(t.send({message:{request:"decline",code:480}}),r(e))}})}))},hangup:function(){t.send({message:{request:"hangup"}}),t.hangup()},decline:function(){t.send({message:{request:"decline"}})},sendDtmf:function e(n,r=0){if(n.length<2)t.send({message:{request:"dtmf_info",digit:n}});else{if(void 0===n[r])return;t.send({message:{request:"dtmf_info",digit:n[r]},success:()=>{setTimeout((()=>{const t=r+1;void 0!==n[t]&&e(n,t)}),500)},error:t=>{console.log(`Error al enviar el tono DTMF ${n[r]}`,t),e(n,r)}})}},registerSipExtension:C,unregister:function(){t&&t.send({message:{request:"unregister"}})},getCallId:function(){return y},server:function(){return n.getServer()},onCallingError:e=>{c=e},onErrorAttachSip:e=>{d=e},changeMicrophone:function(e){w||(w=e),w=e!==h,h=e,t.createOffer({media:{audioSend:!0,audioRecv:!0,videoSend:!1,videoRecv:!1,replaceAudio:w,audio:{deviceId:{exact:h}}}})},destroy:function(e=null){n.destroy({notifyDestroyed:!0,cleanupHandles:!0,success:()=>{clearTimeout(u),clearTimeout(v),e&&e()}})},onDestroyedSession:e=>{l=e},stopAllTracks:function(){T.stopAllTracks(p)},unregisterSipExtension:function(){t.send({message:{request:"unregister"}})},sessionId:()=>n.getSessionId(),setUniqueId:e=>f=e}}var I={init(e,n,t,r=!1,i=null,o=null,a=null){return new A({server:e,api_secret:n,extension:t,watchRTCEnabled:r,stunServer:i,callbackSocketRemote:o,callbackSocketLocal:a})},randomId(){return T.randomString(12)}};const _=["src"],M={key:0};var O=(0,e.defineComponent)({props:{phoneWidgetParams:{required:!0,type:Object},isInCall:{required:!0,type:Boolean},isCalling:{required:!0,type:Boolean}}}),j=(r(540),r(262)),V=(0,j.A)(O,[["render",function(n,t,r,i,o,a){return(0,e.openBlock)(),(0,e.createElementBlock)("div",{class:(0,e.normalizeClass)(["phone-button",{"phone-button--idle":!n.isCalling&&!n.isInCall},{"phone-button--call":n.isInCall},{"phone-button--calling":n.isCalling}])},[(0,e.createElementVNode)("img",{class:"phone-button__widget-icon",src:n.phoneWidgetParams.logoImage,alt:"widget-button-icon"},null,8,_),n.phoneWidgetParams.iconMessage.length>0?((0,e.openBlock)(),(0,e.createElementBlock)("p",M,(0,e.toDisplayString)(n.phoneWidgetParams.iconMessage),1)):(0,e.createCommentVNode)("v-if",!0)],2)}],["__scopeId","data-v-7a0d2670"]]),L=(0,e.defineComponent)({components:{PhoneButton:V},props:{callback:{type:String,required:!0}},setup(n){const{initSip:t,isExtensionRegistered:r,callTo:i,isInCall:o,isCalling:a,hangup:s}=function(){const n={number:"",secret:"",displayname:"",domain:""},t={number:"",name:""};let r=[],i=[],o=[];const a=(0,e.ref)(!1),s=(0,e.ref)(!1),c=(0,e.ref)(!1);let d=null;const l=(0,e.ref)("");return{isExtensionRegistered:a,initSip:async(e,l)=>{if(!d)try{const u=await fetch(`http://127.0.0.1:8001/api/phone_widgets/callback/${e}`),p=await u.json();if(i=p.mediaServers,r=i.map((e=>Object.values(e)[0])),o=i.map((e=>Object.values(e)[1])),n.number=p.extension.extension,n.secret=p.extension.secret,n.domain=p.pbxDomain,t.number=p.callTo,d=I.init(r,o[0],n,!1,null,null),!d)return;l&&d.attachAudio(l),await d.startConnection(),d.onSipMessage(((e,n)=>{const t=e.result?e.result.event:"",r=n?n.type:"";"registered"===t&&(a.value=!0),"hangup"===t&&(d?.hangup(),d?.stopAllTracks(),s.value=!1,c.value=!1),"accepted"===t&&(s.value=!0,c.value=!1),"answer"===r&&c&&l&&(l.volume=1)}))}catch(e){console.log(e)}},callBack:l,callTo:()=>{d?.call(t.number.toString(),t.number.toString()),c.value=!0},isInCall:s,isCalling:c,hangup:()=>{d?.hangup(),d?.stopAllTracks(),c.value=!1,s.value=!1},extension:n}}(),c=(0,e.ref)(null),d=(0,e.ref)(!1),l=(0,e.ref)(0),u=(0,e.computed)((()=>{const e=Math.floor(l.value/60),n=l.value-60*e;return`${e<10?"0":""}${e}:${n<10?"0":""}${n}`})),p=(0,e.ref)(0);let f=(0,e.reactive)({idleState:{mainMessage:""},callingState:{mainMessage:"",secondaryMessage:""},inCallState:{mainMessage:""},logoImage:"",iconMessage:""});return(0,e.watch)(o,(e=>{e?p.value=setInterval((()=>{l.value++}),1e3):0!==p.value&&(l.value=0,clearInterval(p.value))})),(0,e.onMounted)((async()=>{if(c.value){c.value.volume=1,await t(n.callback,c.value);try{const e=await fetch(`https://storage.googleapis.com/simplificloud-1534336262931.appspot.com/phone-widgets/2/${n.callback}.json?nocache=${Date()}`),t=await e.json();Object.assign(f,t),console.log(t)}catch(e){console.log(e)}}})),{isExtensionRegistered:r,handleCall:()=>{o.value||(c.value?.play(),c.value&&(c.value.volume=0),i())},sipAudioElement:c,initSip:t,isInCall:o,isShowDropdown:d,isCalling:a,formatedTimer:u,hangup:s,phoneWidgetParams:f}}});r(316),r(490);var N=(0,j.A)(L,[["render",function(n,r,i,y,S,C){const k=(0,e.resolveComponent)("PhoneButton");return(0,e.openBlock)(),(0,e.createElementBlock)("div",null,[n.isExtensionRegistered?((0,e.openBlock)(),(0,e.createElementBlock)("div",t,[n.isShowDropdown?(0,e.createCommentVNode)("v-if",!0):((0,e.openBlock)(),(0,e.createBlock)(k,{key:0,phoneWidgetParams:n.phoneWidgetParams,onClick:r[0]||(r[0]=e=>n.isShowDropdown=!0),isInCall:n.isInCall,isCalling:n.isCalling},null,8,["phoneWidgetParams","isInCall","isCalling"])),n.isShowDropdown?((0,e.openBlock)(),(0,e.createElementBlock)("div",o,[(0,e.createCommentVNode)(' <div\n          class="phone-widget__dropdown-header"\n          :style="`background: ${phoneCurrentStyles.background};`"\n        >\n          <img\n            class="phone-widget__dropdown-header-image"\n            :src="phoneCurrentStyles.image.src"\n            alt="logotipo"\n          />\n          <div class="phone-widget__dropdown-header-options"></div>\n        </div> '),(0,e.createElementVNode)("div",a,[((0,e.openBlock)(),(0,e.createElementBlock)("svg",{onClick:r[1]||(r[1]=e=>n.isShowDropdown=!1),class:"phone-widget__dropdown-minimize-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},s))]),(0,e.createElementVNode)("div",c,[(0,e.createElementVNode)("div",d,[n.isCalling||n.isInCall?(0,e.createCommentVNode)("v-if",!0):((0,e.openBlock)(),(0,e.createElementBlock)("div",l,[u,(0,e.createElementVNode)("div",{class:"phone-widget__dropdown-advice-idle-circle",onClick:r[2]||(r[2]=(...e)=>n.handleCall&&n.handleCall(...e))},p)])),n.isCalling?((0,e.openBlock)(),(0,e.createElementBlock)("div",f,v)):(0,e.createCommentVNode)("v-if",!0),n.isInCall?((0,e.openBlock)(),(0,e.createElementBlock)("div",m,[g,(0,e.createElementVNode)("span",null,(0,e.toDisplayString)(n.formatedTimer),1),(0,e.createElementVNode)("div",h,[((0,e.openBlock)(),(0,e.createElementBlock)("svg",{onClick:r[3]||(r[3]=(...e)=>n.hangup&&n.hangup(...e)),class:"phone-widget__dropdown-advice-in-call-circle-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},w))])])):(0,e.createCommentVNode)("v-if",!0)])])])):(0,e.createCommentVNode)("v-if",!0)])):(0,e.createCommentVNode)("v-if",!0),(0,e.createElementVNode)("video",b,null,512)])}],["__scopeId","data-v-0dae9322"]])}(),i}()}));